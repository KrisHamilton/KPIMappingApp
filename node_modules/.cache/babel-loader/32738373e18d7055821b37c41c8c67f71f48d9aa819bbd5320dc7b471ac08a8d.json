{"ast":null,"code":"import _objectSpread from\"C:/Users/krist/Documents/KPI Map Builder v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useRef}from\"react\";import ReactFlow,{MiniMap,Controls,Background,BackgroundVariant,MarkerType,applyNodeChanges}from\"reactflow\";import dagre from\"dagre\";import html2canvas from\"html2canvas\";import jsPDF from\"jspdf\";import domtoimage from\"dom-to-image-more\";import\"reactflow/dist/style.css\";import FloatingEdge from\"./FloatingEdge\";// Utils\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const uid=function(){let prefix=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"id\";return\"\".concat(prefix,\"_\").concat(Date.now().toString(36),\"_\").concat(Math.floor(Math.random()*1000));};const nodeWidth=180;const nodeHeight=48;const PAD=16;// padding to prevent touching\n// Lever Data (unchanged)\nconst initialLeversData=[{id:\"lev_cdh\",name:\"Customer Decision Hub\",features:[{id:\"cdh_nba_designer\",name:\"Next-Best-Action Designer\",rules:[\"NBA Strategies (Upsell, Cross-sell, Retention, Acquisition, Nurture, Loyalty, Onboarding, Collections)\",\"Engagement Policies\",\"Action Arbitration\",\"Prioritization Logic\",\"Eligibility Rules\",\"Suppression Rules\"]},{id:\"cdh_actions_treatments\",name:\"Actions & Treatments\",rules:[\"Action Configuration\",\"Treatment Variations (per channel)\",\"Offer Bundling\",\"Message Personalization\",\"Channel Assignment\"]},{id:\"cdh_analytics\",name:\"Analytical Tools\",rules:[\"Impact Analyzer\",\"Value Finder\",\"Simulation Testing\",\"Engagement Metrics\",\"Journey Monitoring & Visualization\"]},{id:\"cdh_ai_ml\",name:\"AI & Machine Learning\",rules:[\"Predictive Model Building\",\"Adaptive Modeling\",\"Import 3rd Party Models (PMML, H2O.ai)\",\"Real-Time AI Connectors (Google Cloud ML, Amazon SageMaker)\",\"Natural Language Processing & Text Analytics\",\"Model Transparency Controls\",\"GenAI CDH Assistant\"]},{id:\"cdh_profiles\",name:\"Customer Profiles\",rules:[\"Customer Profile Designer\",\"Customer Profile Viewer\",\"Interaction History\",\"Audience & Profile Data Management\",\"Multi-level Customer Data Management\",\"Complex Event Processing\",\"Streaming Data Management\"]},{id:\"cdh_journeys\",name:\"Customer Journeys\",rules:[\"Next-Best-Action Customer Journeys\",\"Journey Monitoring & Visualization\",\"Channel, Treatment, Engagement, and Throughput Monitoring\"]},{id:\"cdh_channels\",name:\"Engagement Channels\",rules:[\"Inbound (Web, Mobile, ATM, Kiosk, Contact Center, Retail, Branch)\",\"Outbound (Email, SMS, Direct Mail)\",\"Preference Management (GDPR Compliance)\",\"Real-time Web Personalization\",\"Interactive Digital Microsites\"]},{id:\"cdh_context\",name:\"Context Dictionary & Switching\",rules:[\"Context Dictionary Configuration\",\"Context Switching in Strategy Canvas\",\"Multilevel Context Definition\"]},{id:\"cdh_portal\",name:\"Customer Decision Hub Portal\",rules:[\"Role-based Information Layout\",\"Application Overview\",\"Ruleset Management\",\"Performance Data\"]}]},{id:\"lev_rpa\",name:\"Robotic Process Automation\"},{id:\"lev_ai\",name:\"Artificial Intelligence & Decisioning\"},{id:\"lev_case_mgmt\",name:\"Case Management\"},{id:\"lev_workflow\",name:\"Workflow Automation\"},{id:\"lev_proc_mining\",name:\"Process Mining\"},{id:\"lev_rules\",name:\"Business Rules Engine\"},{id:\"lev_integration\",name:\"Integration (APIs, Connectors)\"},{id:\"lev_data_mgmt\",name:\"Data Management\"},{id:\"lev_uiux\",name:\"UI/UX Components\"},{id:\"lev_reporting\",name:\"Reporting & Analytics\"},{id:\"lev_sla\",name:\"SLA Management\"},{id:\"lev_notifications\",name:\"Notifications & Alerts\"},{id:\"lev_security\",name:\"Security & Access Control\"},{id:\"lev_mobile\",name:\"Mobile Application Support\"},{id:\"lev_multichannel\",name:\"Multi-Channel Communication\"},{id:\"lev_docs\",name:\"Document Generation & Management\"},{id:\"lev_audit\",name:\"Audit & Compliance Tracking\"},{id:\"lev_legacy\",name:\"Legacy System Integration\"},{id:\"lev_reusable\",name:\"Reusable Components\"},{id:\"lev_testing\",name:\"Testing & Quality Assurance Tools\"},{id:\"lev_devops\",name:\"Deployment & DevOps Tools\"},{id:\"lev_portal\",name:\"User Portal & Dashboards\"},{id:\"lev_exception\",name:\"Exception Handling\"},{id:\"lev_case_lifecycle\",name:\"Case Lifecycle Management\"},{id:\"lev_microjourney\",name:\"Microjourneys\"},{id:\"lev_cust_service\",name:\"Customer Service Automation\"},{id:\"lev_sales\",name:\"Sales Automation\"},{id:\"lev_rda\",name:\"Robotic Desktop Automation\"},{id:\"lev_knowledge\",name:\"Knowledge Management\"},{id:\"lev_predictive\",name:\"Predictive Analytics\"},{id:\"lev_adaptive\",name:\"Adaptive Models\"},{id:\"lev_realtime\",name:\"Real-Time Event Processing\"},{id:\"lev_ext_data\",name:\"External Data Integration\"},{id:\"lev_data_transform\",name:\"Data Transformation\"},{id:\"lev_batch\",name:\"Batch Processing\"},{id:\"lev_rule_delegate\",name:\"Rule Delegation\"},{id:\"lev_versioning\",name:\"Application Versioning\"},{id:\"lev_change_mgmt\",name:\"Change Management\"},{id:\"lev_perf_monitor\",name:\"Performance Monitoring\"},{id:\"lev_kpi\",name:\"Value Measurement & KPI Tracking\"}];function getDagreLayout(elements){let direction=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"TB\";let nodeSpacing=arguments.length>2&&arguments[2]!==undefined?arguments[2]:50;const g=new dagre.graphlib.Graph();g.setDefaultEdgeLabel(()=>({}));g.setGraph({rankdir:direction,nodesep:nodeSpacing,ranksep:nodeSpacing});elements.forEach(el=>{if(el.data&&el.data.type===\"node\"){g.setNode(el.id,{width:nodeWidth,height:nodeHeight});}});elements.filter(e=>e.source&&e.target).forEach(edge=>g.setEdge(edge.source,edge.target));dagre.layout(g);return elements.map(el=>{if(el.data&&el.data.type===\"node\"){const p=g.node(el.id);if(p)el.position={x:p.x-nodeWidth/2,y:p.y-nodeHeight/2};}return el;});}function cleanImportedData(data){// Collect all valid node IDs\nconst allNodeIds=new Set();(data.kpis||[]).forEach(kpi=>{allNodeIds.add(kpi.id);(kpi.drivers||[]).forEach(driver=>{allNodeIds.add(driver.id);(driver.levers||[]).forEach(lever=>{allNodeIds.add(lever.id);});});});// Remove positions for missing nodes\nif(data.positions){Object.keys(data.positions).forEach(id=>{if(!allNodeIds.has(id)){delete data.positions[id];}});}return data;}function nodeStyle(category){if(category===\"kpi\")return{background:\"#374151\",color:\"#fff\",padding:10,borderRadius:8,width:nodeWidth};if(category===\"driver\")return{background:\"#0d9488\",color:\"#fff\",padding:10,borderRadius:8,width:nodeWidth};return{background:\"#f59e0b\",color:\"#042027\",padding:10,borderRadius:8,width:nodeWidth};}function radialPositions(n,cx,cy,r){let startAngle=arguments.length>4&&arguments[4]!==undefined?arguments[4]:-Math.PI/2;const positions=[];if(n===0)return positions;const step=2*Math.PI/Math.max(n,1);for(let i=0;i<n;i++){const theta=startAngle+i*step;positions.push({x:cx+r*Math.cos(theta),y:cy+r*Math.sin(theta),angle:theta,step});}return positions;}const safeRadiusForArc=(stepAngle,requiredArc)=>requiredArc/Math.max(stepAngle,1e-6);/** Multi-ring lever placement (no overlap) */function placeLeversNoOverlap(_ref){let{L,centerX,centerY,baseRadius,driverAngle,driverGapAngle,leverArcCapRatio=0.8,leverBaseArcDeg=20,leverArcPerItemDeg=10,radialGapBase=nodeHeight+28}=_ref;if(L<=0)return[];const maxLocalArc=driverGapAngle*leverArcCapRatio;const desiredLocalArcDeg=Math.min(leverBaseArcDeg+leverArcPerItemDeg*(L-1),140);const desiredLocalArc=Math.min(maxLocalArc,desiredLocalArcDeg*Math.PI/180);if(L===1){const r=Math.max(baseRadius,nodeWidth+PAD);return[{x:centerX+r*Math.cos(driverAngle),y:centerY+r*Math.sin(driverAngle)}];}const positions=[];let remaining=L;let ringIndex=0;while(remaining>0&&ringIndex<20){const ringRadius=baseRadius+ringIndex*radialGapBase;const minDeltaAngle=(nodeWidth+PAD)/ringRadius;let capacity=Math.max(1,Math.floor(desiredLocalArc/Math.max(minDeltaAngle,1e-6))+1);if(capacity<=1&&desiredLocalArc>0){ringIndex+=1;continue;}const count=Math.min(remaining,capacity);const delta=count>1?desiredLocalArc/(count-1):0;for(let i=0;i<count;i++){const offsetAngle=count===1?0:-desiredLocalArc/2+i*delta;const theta=driverAngle+offsetAngle;positions.push({x:centerX+ringRadius*Math.cos(theta),y:centerY+ringRadius*Math.sin(theta)});}remaining-=count;ringIndex+=1;}return positions;}/** Build nodes/edges; respects stored positions when dragEnabled (skip auto layout) */function buildFlowFromData(data){let layoutMode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"vertical\";let filterNodeId=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let islandKpiId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;let dragEnabled=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;const nodes=[];const edges=[];const positionsMap=data.positions||{};const useStored=(id,fallback)=>positionsMap&&positionsMap[id]?_objectSpread({},positionsMap[id]):fallback;if(!data||!Array.isArray(data.kpis))return{nodes,edges};// Helper to add node safely\nconst addNode=(id,label,category,fallback)=>{nodes.push({id,data:{label,type:\"node\",category},position:useStored(id,fallback),style:nodeStyle(category)});};// Build full vertical layout\nif(layoutMode===\"vertical\"){const tmpNodes=[];const tmpEdges=[];data.kpis.forEach((kpi,ki)=>{tmpNodes.push({id:kpi.id,data:{label:kpi.name,type:\"node\",category:\"kpi\"},position:useStored(kpi.id,{x:100+ki*40,y:80+ki*20}),style:nodeStyle(\"kpi\")});(kpi.drivers||[]).forEach((drv,di)=>{tmpNodes.push({id:drv.id,data:{label:drv.name,type:\"node\",category:\"driver\"},position:useStored(drv.id,{x:420+di*40,y:160+di*50}),style:nodeStyle(\"driver\")});tmpEdges.push({id:\"e-\".concat(kpi.id,\"-\").concat(drv.id),source:kpi.id,target:drv.id,type:\"floating\",markerEnd:{type:MarkerType.ArrowClosed}});(drv.levers||[]).forEach((lvr,li)=>{tmpNodes.push({id:lvr.id,data:{label:lvr.name,type:\"node\",category:\"lever\"},position:useStored(lvr.id,{x:740+li*40,y:160+di*50+li*10}),style:nodeStyle(\"lever\")});tmpEdges.push({id:\"e-\".concat(drv.id,\"-\").concat(lvr.id),source:drv.id,target:lvr.id,type:\"floating\",markerEnd:{type:MarkerType.ArrowClosed}});});});});// If filterNodeId present, filter nodes/edges to the relevant subgraph\nif(filterNodeId){const keepIds=new Set();// find KPI or driver that matches filterNodeId\ndata.kpis.forEach(kpi=>{if(kpi.id===filterNodeId){keepIds.add(kpi.id);(kpi.drivers||[]).forEach(d=>{keepIds.add(d.id);(d.levers||[]).forEach(l=>keepIds.add(l.id));});}else{(kpi.drivers||[]).forEach(d=>{if(d.id===filterNodeId){keepIds.add(kpi.id);keepIds.add(d.id);(d.levers||[]).forEach(l=>keepIds.add(l.id));}});}});// filter\nconst filteredNodes=tmpNodes.filter(n=>keepIds.has(n.id));const filteredEdges=tmpEdges.filter(e=>keepIds.has(e.source)&&keepIds.has(e.target));if(dragEnabled)return{nodes:filteredNodes,edges:filteredEdges};const positioned=getDagreLayout([...filteredNodes,...filteredEdges],\"TB\");return{nodes:positioned.filter(n=>n.data&&n.data.type===\"node\"),edges:positioned.filter(e=>e.source&&e.target)};}if(dragEnabled)return{nodes:tmpNodes,edges:tmpEdges};const positioned=getDagreLayout([...tmpNodes,...tmpEdges],\"TB\");return{nodes:positioned.filter(n=>n.data&&n.data.type===\"node\"),edges:positioned.filter(e=>e.source&&e.target)};}// === Island (radial, single KPI focus) ===\nconst focusedKpi=islandKpiId?data.kpis.find(k=>k.id===islandKpiId):data.kpis[0];if(!focusedKpi)return{nodes,edges};const centerX=720,centerY=420;addNode(focusedKpi.id,focusedKpi.name,\"kpi\",{x:centerX-nodeWidth/2,y:centerY-nodeHeight/2});const nDrivers=(focusedKpi.drivers||[]).length;if(nDrivers>0){const baseR1=200,baseR2=baseR1+220;const driverStep=2*Math.PI/nDrivers;const R1=Math.max(baseR1,safeRadiusForArc(driverStep,nodeWidth+PAD));const dposList=radialPositions(nDrivers,centerX,centerY,R1);focusedKpi.drivers.forEach((drv,di)=>{const dpos=dposList[di],angle=dpos.angle;const driverFallback={x:dpos.x-nodeWidth/2,y:dpos.y-nodeHeight/2};addNode(drv.id,drv.name,\"driver\",driverFallback);edges.push({id:\"e-\".concat(focusedKpi.id,\"-\").concat(drv.id),source:focusedKpi.id,target:drv.id,type:\"floating\",markerEnd:{type:MarkerType.ArrowClosed}});const leverPositions=placeLeversNoOverlap({L:(drv.levers||[]).length,centerX,centerY,baseRadius:baseR2,driverAngle:angle,driverGapAngle:dpos.step});(drv.levers||[]).forEach((lvr,idx)=>{const lp=leverPositions[idx];const leverFallback=lp?{x:lp.x-nodeWidth/2,y:lp.y-nodeHeight/2}:{x:dpos.x-nodeWidth/2+260,y:dpos.y-nodeHeight/2};addNode(lvr.id,lvr.name,\"lever\",leverFallback);edges.push({id:\"e-\".concat(drv.id,\"-\").concat(lvr.id),source:drv.id,target:lvr.id,type:\"floating\",markerEnd:{type:MarkerType.ArrowClosed}});});});}return{nodes,edges};}function LeverSelector(_ref2){let{onSelect}=_ref2;const[selectedLeverId,setSelectedLeverId]=React.useState(\"\");const[selectedRule,setSelectedRule]=React.useState(\"\");const[customLever,setCustomLever]=React.useState(\"\");// Find the selected lever object\nconst selectedLever=initialLeversData.find(l=>l.id===selectedLeverId);// If CDH is selected, flatten all rules under its features\nconst cdhRules=(selectedLever===null||selectedLever===void 0?void 0:selectedLever.id)===\"lev_cdh\"?selectedLever.features.flatMap(f=>f.rules.map(rule=>({feature:f.name,rule}))):[];const handleAddLever=()=>{if(selectedLeverId===\"lev_cdh\"&&selectedRule){onSelect({id:\"cdh_\".concat(selectedRule.replace(/\\s+/g,\"_\").toLowerCase()),name:\"CDH: \".concat(selectedRule)});setSelectedLeverId(\"\");setSelectedRule(\"\");setCustomLever(\"\");}else if(selectedLeverId&&selectedLeverId!==\"lev_cdh\"){onSelect(selectedLever);setSelectedLeverId(\"\");setSelectedRule(\"\");setCustomLever(\"\");}else if(customLever.trim()){onSelect({id:\"custom_\".concat(Date.now()),name:customLever});setCustomLever(\"\");setSelectedLeverId(\"\");setSelectedRule(\"\");}};return/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"column\",gap:8,marginBottom:8},children:[/*#__PURE__*/_jsxs(\"select\",{value:selectedLeverId,onChange:e=>{setSelectedLeverId(e.target.value);setSelectedRule(\"\");},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a predefined lever\"}),initialLeversData.map(lever=>/*#__PURE__*/_jsx(\"option\",{value:lever.id,children:lever.name},lever.id))]}),selectedLeverId===\"lev_cdh\"&&/*#__PURE__*/_jsxs(\"select\",{value:selectedRule,onChange:e=>setSelectedRule(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a CDH rule/feature\"}),cdhRules.map((r,idx)=>/*#__PURE__*/_jsxs(\"option\",{value:r.rule,children:[r.feature,\": \",r.rule]},idx))]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Or enter a custom lever\",value:customLever,onChange:e=>setCustomLever(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:handleAddLever,children:\"Add\"})]});}function SidebarTree(_ref3){let{data,setData,onLayoutChange,layoutMode,onFocusIslandKpi,islandKpiId,onCenterKpi}=_ref3;const[expanded,setExpanded]=useState({});const[addingKpi,setAddingKpi]=useState(false);const[addingDriver,setAddingDriver]=useState(null);const[addingLever,setAddingLever]=useState(null);const[newName,setNewName]=useState(\"\");useEffect(()=>{setExpanded(prev=>{const next=_objectSpread({},prev);const ids=new Set((data.kpis||[]).map(k=>k.id));Object.keys(next).forEach(id=>{if(!ids.has(id))delete next[id];});(data.kpis||[]).forEach(k=>{if(!(k.id in next))next[k.id]=false;});return next;});},[data.kpis]);function toggleExpand(id){setExpanded(s=>_objectSpread(_objectSpread({},s),{},{[id]:!s[id]}));}function confirmAddKpi(){if(!newName.trim())return;const next=JSON.parse(JSON.stringify(data));const newKpi={id:uid(\"kpi\"),name:newName.trim(),drivers:[]};next.kpis.push(newKpi);next.positions=next.positions||{};next.positions[newKpi.id]={x:120,y:120};setData(next);setExpanded(prev=>_objectSpread(_objectSpread({},prev),{},{[newKpi.id]:true}));setAddingKpi(false);setNewName(\"\");}function confirmAddDriver(kpiId){var _next$positions$kpiId,_next$positions$kpiId2;if(!newName.trim())return;const next=JSON.parse(JSON.stringify(data));const k=next.kpis.find(x=>x.id===kpiId);const newDriver={id:uid(\"drv\"),name:newName.trim(),levers:[]};k.drivers.push(newDriver);next.positions=next.positions||{};next.positions[newDriver.id]={x:(((_next$positions$kpiId=next.positions[kpiId])===null||_next$positions$kpiId===void 0?void 0:_next$positions$kpiId.x)||200)+220,y:((_next$positions$kpiId2=next.positions[kpiId])===null||_next$positions$kpiId2===void 0?void 0:_next$positions$kpiId2.y)||200};setData(next);setAddingDriver(null);setNewName(\"\");}function confirmAddLever(kpiId,drvId){var _next$positions$drvId,_next$positions$drvId2;if(!newName.trim())return;const next=JSON.parse(JSON.stringify(data));const k=next.kpis.find(x=>x.id===kpiId);const d=k.drivers.find(x=>x.id===drvId);const newLever={id:uid(\"lvr\"),name:newName.trim()};d.levers.push(newLever);next.positions=next.positions||{};next.positions[newLever.id]={x:(((_next$positions$drvId=next.positions[drvId])===null||_next$positions$drvId===void 0?void 0:_next$positions$drvId.x)||400)+220,y:((_next$positions$drvId2=next.positions[drvId])===null||_next$positions$drvId2===void 0?void 0:_next$positions$drvId2.y)||200};setData(next);setAddingLever(null);setNewName(\"\");}function removeKpi(kpiId){if(!confirm(\"Remove KPI and all children?\"))return;const next=JSON.parse(JSON.stringify(data));const k=next.kpis.find(x=>x.id===kpiId);if(k){var _next$positions3;k.drivers.forEach(d=>{var _next$positions2;d.levers.forEach(l=>{var _next$positions;return(_next$positions=next.positions)===null||_next$positions===void 0?true:delete _next$positions[l.id];});(_next$positions2=next.positions)===null||_next$positions2===void 0?true:delete _next$positions2[d.id];});(_next$positions3=next.positions)===null||_next$positions3===void 0?true:delete _next$positions3[k.id];}next.kpis=next.kpis.filter(kk=>kk.id!==kpiId);setData(next);onFocusIslandKpi(null);setExpanded(prev=>{const p=_objectSpread({},prev);delete p[kpiId];return p;});}function removeDriver(kpiId,drvId){var _next$positions5;if(!confirm(\"Remove Driver and its levers?\"))return;const next=JSON.parse(JSON.stringify(data));const k=next.kpis.find(x=>x.id===kpiId);const d=k.drivers.find(x=>x.id===drvId);d.levers.forEach(l=>{var _next$positions4;return(_next$positions4=next.positions)===null||_next$positions4===void 0?true:delete _next$positions4[l.id];});k.drivers=k.drivers.filter(d0=>d0.id!==drvId);(_next$positions5=next.positions)===null||_next$positions5===void 0?true:delete _next$positions5[drvId];setData(next);}function removeLever(kpiId,drvId,leverId){var _next$positions6;if(!confirm(\"Remove Lever?\"))return;const next=JSON.parse(JSON.stringify(data));const k=next.kpis.find(x=>x.id===kpiId);const d=k.drivers.find(x=>x.id===drvId);d.levers=d.levers.filter(l=>l.id!==leverId);(_next$positions6=next.positions)===null||_next$positions6===void 0?true:delete _next$positions6[leverId];setData(next);}function renameNode(type,ids){const name=prompt(\"New name\");if(!name)return;const next=JSON.parse(JSON.stringify(data));if(type===\"kpi\"){next.kpis.find(x=>x.id===ids.kpiId).name=name;}else if(type===\"driver\"){const k=next.kpis.find(x=>x.id===ids.kpiId);k.drivers.find(x=>x.id===ids.driverId).name=name;}else{const k=next.kpis.find(x=>x.id===ids.kpiId);const d=k.drivers.find(x=>x.id===ids.driverId);d.levers.find(x=>x.id===ids.leverId).name=name;}setData(next);}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:0},children:\"KPIs\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",gap:8},children:/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>{setAddingKpi(true);setNewName(\"\");},children:\"+ KPI\"})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8},children:[data.kpis.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"muted\",children:\"No KPIs yet \\u2014 add one to get started.\"}),data.kpis.map(k=>{const isFocused=islandKpiId===k.id;return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:8,borderRadius:6,background:\"#0f1724\",padding:8},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:8,alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>toggleExpand(k.id),children:expanded[k.id]?\"▾\":\"▸\"}),/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>onCenterKpi(k.id),children:/*#__PURE__*/_jsx(\"strong\",{style:{color:\"#e6eef6\"},children:k.name})}),layoutMode===\"island\"&&/*#__PURE__*/_jsx(\"small\",{style:{color:isFocused?\"#7dd3fc\":\"#94a3b8\"},children:isFocused?\" (focused)\":\"\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:6},children:[/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>{onFocusIslandKpi(k.id);onCenterKpi(k.id);},children:\"Focus\"}),/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>renameNode(\"kpi\",{kpiId:k.id}),children:\"Rename\"}),/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>{setAddingDriver(k.id);setNewName(\"\");},children:\"+Drv\"}),/*#__PURE__*/_jsx(\"button\",{className:\"link danger\",onClick:()=>removeKpi(k.id),children:\"Del\"})]})]}),expanded[k.id]&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8,paddingLeft:18},children:[addingDriver===k.id&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:8,padding:6,background:\"#081222\",borderRadius:6},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Driver name\",value:newName,onChange:e=>setNewName(e.target.value),onKeyDown:e=>e.key===\"Enter\"&&confirmAddDriver(k.id),autoFocus:true,style:{width:\"100%\",padding:6,background:\"#061322\",border:\"1px solid #15202b\",borderRadius:4,color:\"#e6eef6\",marginBottom:6}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:6},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>confirmAddDriver(k.id),children:\"Add\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>{setAddingDriver(null);setNewName(\"\");},children:\"Cancel\"})]})]}),k.drivers.length===0&&!addingDriver&&/*#__PURE__*/_jsx(\"div\",{className:\"muted\",children:\"No Drivers\"}),k.drivers.map(d=>/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:6,padding:6,borderRadius:6,background:\"#081222\"},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",gap:8,alignItems:\"center\"},children:/*#__PURE__*/_jsx(\"small\",{style:{color:\"#cfeef8\"},children:d.name})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:6},children:[/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>renameNode(\"driver\",{kpiId:k.id,driverId:d.id}),children:\"Rename\"}),/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>{setAddingLever({kpiId:k.id,drvId:d.id});setNewName(\"\");},children:\"+Lvr\"}),/*#__PURE__*/_jsx(\"button\",{className:\"link danger\",onClick:()=>removeDriver(k.id,d.id),children:\"Del\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:6,paddingLeft:12},children:[(addingLever===null||addingLever===void 0?void 0:addingLever.kpiId)===k.id&&(addingLever===null||addingLever===void 0?void 0:addingLever.drvId)===d.id&&/*#__PURE__*/_jsx(LeverSelector,{onSelect:leverObj=>{var _next$positions$d$id,_next$positions$d$id2;const next=JSON.parse(JSON.stringify(data));const kpi=next.kpis.find(x=>x.id===k.id);const drv=kpi.drivers.find(x=>x.id===d.id);drv.levers.push({id:leverObj.id,name:leverObj.name});next.positions=next.positions||{};next.positions[leverObj.id]={x:(((_next$positions$d$id=next.positions[d.id])===null||_next$positions$d$id===void 0?void 0:_next$positions$d$id.x)||400)+220,y:((_next$positions$d$id2=next.positions[d.id])===null||_next$positions$d$id2===void 0?void 0:_next$positions$d$id2.y)||200};setData(next);setAddingLever(null);setNewName(\"\");}}),d.levers.length===0&&!addingLever&&/*#__PURE__*/_jsx(\"div\",{className:\"muted\",children:\"No Levers\"}),d.levers.map(l=>/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",marginBottom:4},children:[/*#__PURE__*/_jsx(\"small\",{children:l.name}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:6},children:[/*#__PURE__*/_jsx(\"button\",{className:\"link\",onClick:()=>renameNode(\"lever\",{kpiId:k.id,driverId:d.id,leverId:l.id}),children:\"Rename\"}),/*#__PURE__*/_jsx(\"button\",{className:\"link danger\",onClick:()=>removeLever(k.id,d.id,l.id),children:\"Del\"})]})]},l.id))]})]},d.id))]})]},k.id);})]}),addingKpi&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8,padding:8,background:\"#0f1724\",borderRadius:6},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"KPI name\",value:newName,onChange:e=>setNewName(e.target.value),onKeyDown:e=>e.key===\"Enter\"&&confirmAddKpi(),autoFocus:true,style:{width:\"100%\",padding:6,background:\"#081222\",border:\"1px solid #15202b\",borderRadius:4,color:\"#e6eef6\",marginBottom:6}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:6},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:confirmAddKpi,children:\"Add\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>{setAddingKpi(false);setNewName(\"\");},children:\"Cancel\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:\"flex\",alignItems:\"center\",gap:8},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:layoutMode===\"island\",onChange:e=>onLayoutChange(e.target.checked?\"island\":\"vertical\")}),/*#__PURE__*/_jsx(\"small\",{children:\"Island (radial) layout \\u2014 single KPI focus\"})]}),layoutMode===\"island\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"muted\",style:{marginTop:6},children:[\"Click a KPI name and press \",/*#__PURE__*/_jsx(\"em\",{children:\"Focus\"}),\" to set the island focus.\"]})]})]});}function JsonEditor(_ref4){let{data,setData}=_ref4;const[open,setOpen]=useState(false);const[text,setText]=useState(JSON.stringify(data,null,2));useEffect(()=>{setText(JSON.stringify(data,null,2));},[data]);function apply(){try{const parsed=JSON.parse(text);if(!parsed||!Array.isArray(parsed.kpis))throw new Error(\"Root must have kpis array\");if(!parsed.positions)parsed.positions={};setData(cleanImportedData(parsed));}catch(err){alert(\"Invalid JSON: \"+err.message);}}return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>setOpen(!open),children:open?\"Hide JSON Editor\":\"Show JSON Editor\"}),open&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8},children:[/*#__PURE__*/_jsx(\"textarea\",{value:text,onChange:e=>setText(e.target.value),rows:10,style:{width:\"100%\",fontFamily:\"monospace\",background:\"#061322\",color:\"#e6eef6\",borderRadius:6,padding:8}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:8,marginTop:6},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:apply,children:\"Apply JSON\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>setText(JSON.stringify({kpis:[],positions:{}},null,2)),children:\"Reset to empty\"})]})]})]});}function App(){const[data,setData]=useState({kpis:[],positions:{}});const[layoutMode,setLayoutMode]=useState(\"vertical\");const[rfNodes,setRfNodes]=useState([]);const[rfEdges,setRfEdges]=useState([]);const[filterNodeId,setFilterNodeId]=useState(null);const[islandKpiId,setIslandKpiId]=useState(null);const[sidebarOpen,setSidebarOpen]=useState(true);const[dragToggle,setDragToggle]=useState(false);// user toggle\nconst canvasRef=useRef(null);const reactFlowInstanceRef=useRef(null);const isDraggingRef=useRef(false);// guard rebuilds during drag\n// New: prompt panel state + the predefined prompt text\nconst[promptVisible,setPromptVisible]=useState(false);const measurementPrompt=\"You are acting as a domain expert assistant embedded in a KPI mapping application. Your role is to analyze structured input (JSON) that maps KPIs to their drivers and associated Pega functionalities (\\\"levers\\\") and generate a tailored measurement framework for each KPI.\\nPlease prioritize your response based on the following:\\n\\nUse the JSON structure as your primary knowledge source. It defines the KPI hierarchy and the Pega levers that influence each driver.\\nUse https://docs.pega.com as a preferred reference for implementation details, best practices, and component usage within Pega.\\nYou may also draw from broader domain knowledge in enterprise performance management, customer experience, and intelligent automation where relevant and helpful\\u2014but clearly distinguish when insights are based on general best practices vs. Pega-specific capabilities.\\nAct as a Pega implementation strategist. Your suggestions should reflect how a Pega architect or business analyst would design data collection, reporting, and automation for each KPI.\\nBe specific and actionable. Avoid generic advice. Provide concrete data points, metrics, and implementation ideas using Pega components (e.g., case types, adaptive models, decision tables, CDH strategies).\\nInclude strategic best practices for tracking and improving KPI performance, such as:\\n\\nDesigning closed-loop feedback systems using adaptive analytics and interaction history\\nEnsuring data quality and governance across channels and case types\\nUsing real-time monitoring, alerts, and thresholds to proactively manage KPI performance\\nAligning KPI tracking with business goals, operational workflows, and customer journeys\\nApplying continuous improvement using performance insights to refine strategies, rules, and models\\nLeveraging Pega\\u2019s AI and decisioning capabilities to automate and optimize interventions\\n\\nHere is the JSON structure to analyze:\";const dragEnabled=layoutMode===\"island\"&&dragToggle;// only allow in island\n// Build nodes/edges (skip while dragging to avoid flicker/disappear)\nuseEffect(()=>{if(isDraggingRef.current)return;const{nodes,edges}=buildFlowFromData(data,layoutMode===\"vertical\"?\"vertical\":\"island\",filterNodeId,islandKpiId,dragEnabled);setRfNodes(nodes);setRfEdges(edges);},[data,layoutMode,filterNodeId,islandKpiId,dragEnabled]);// Toggle filter on click (unchanged)\nconst onNodeClick=(_event,node)=>{var _node$data;if((node===null||node===void 0?void 0:(_node$data=node.data)===null||_node$data===void 0?void 0:_node$data.category)===\"lever\")return;setFilterNodeId(prev=>node.id===prev?null:node.id);};// Live drag updates: keep visual in sync without touching data (prevents rebuild mid-drag)\nconst onNodesChange=changes=>{if(!dragEnabled)return;if(!changes||changes.length===0)return;setRfNodes(nds=>applyNodeChanges(changes,nds));};// Persist final position on drag stop (single node)\nconst onNodeDragStart=()=>{if(dragEnabled)isDraggingRef.current=true;};const onNodeDragStop=(_evt,node)=>{if(!dragEnabled||!(node!==null&&node!==void 0&&node.id)){isDraggingRef.current=false;return;}setData(prev=>{const next=JSON.parse(JSON.stringify(prev));next.positions=next.positions||{};next.positions[node.id]={x:node.position.x,y:node.position.y};return next;});// allow rebuild after data update settles\nsetTimeout(()=>{isDraggingRef.current=false;},0);};// Center viewport on a node\nconst centerOnNode=id=>{const inst=reactFlowInstanceRef.current;if(!inst)return;const node=rfNodes.find(n=>n.id===id);if(!node)return;inst.setCenter(node.position.x+nodeWidth/2,node.position.y+nodeHeight/2,{zoom:1.2,duration:300});};// Relayout (Auto) – clear positions then rebuild\nconst relayoutAuto=()=>{setData(prev=>{const next=JSON.parse(JSON.stringify(prev));if(layoutMode===\"vertical\"){next.positions={};}else{if(islandKpiId){const k=next.kpis.find(x=>x.id===islandKpiId);if(k){var _next$positions9;k.drivers.forEach(d=>{var _next$positions8;d.levers.forEach(l=>{var _next$positions7;return(_next$positions7=next.positions)===null||_next$positions7===void 0?true:delete _next$positions7[l.id];});(_next$positions8=next.positions)===null||_next$positions8===void 0?true:delete _next$positions8[d.id];});(_next$positions9=next.positions)===null||_next$positions9===void 0?true:delete _next$positions9[k.id];}}else{next.positions={};}}return next;});};// Exports (unchanged)\nconst fitThen=async fn=>{if(reactFlowInstanceRef.current){reactFlowInstanceRef.current.fitView({padding:0.2,duration:0});await new Promise(r=>setTimeout(r,50));}return fn();};const exportToPDF=()=>fitThen(async()=>{const container=document.querySelector(\".react-flow\");container.classList.add(\"export-clean\");if(!container)return;const screenshot=await html2canvas(container,{backgroundColor:\"#fff\",scale:window.devicePixelRatio*2,useCORS:true});const imgWidth=screenshot.width,imgHeight=screenshot.height;const pdf=new jsPDF({orientation:\"portrait\",unit:\"px\",format:\"a4\"});const pageWidth=pdf.internal.pageSize.getWidth(),pageHeight=pdf.internal.pageSize.getHeight();const margin=20,targetWidth=pageWidth-margin*2,scale=targetWidth/imgWidth;const targetPageContentHeight=pageHeight-margin*2,sliceHeightPx=targetPageContentHeight/scale;const sliceCanvas=document.createElement(\"canvas\");const ctx=sliceCanvas.getContext(\"2d\");let y=0,pageIndex=0;while(y<imgHeight){const sliceHeight=Math.min(sliceHeightPx,imgHeight-y);sliceCanvas.width=imgWidth;sliceCanvas.height=sliceHeight;ctx.clearRect(0,0,sliceCanvas.width,sliceCanvas.height);ctx.drawImage(screenshot,0,y,imgWidth,sliceHeight,0,0,imgWidth,sliceHeight);const imgData=sliceCanvas.toDataURL(\"image/png\");const renderedHeight=sliceHeight*scale;if(pageIndex>0)pdf.addPage();pdf.addImage(imgData,\"PNG\",margin,margin,targetWidth,renderedHeight);y+=sliceHeightPx;pageIndex+=1;}pdf.save(\"kpi-map.pdf\");container.classList.remove(\"export-clean\");});const exportToPNG=()=>fitThen(async()=>{const container=document.querySelector(\".react-flow\");container.classList.add(\"export-clean\");if(!container)return;const screenshot=await html2canvas(container,{backgroundColor:\"#fff\",scale:window.devicePixelRatio*2,useCORS:true});container.classList.remove(\"export-clean\");const a=document.createElement(\"a\");a.href=screenshot.toDataURL(\"image/png\");a.download=\"kpi-map.png\";a.click();});const exportToSVG=()=>fitThen(async()=>{const container=document.querySelector(\".react-flow\");container.classList.add(\"export-clean\");if(!container)return;const dataUrl=await domtoimage.toSvg(container,{bgcolor:\"transparent\",quality:1,cacheBust:true});container.classList.remove(\"export-clean\");const res=await fetch(dataUrl);const blob=await res.blob();const url=URL.createObjectURL(blob);const a=document.createElement(\"a\");a.href=url;a.download=\"kpi-map.svg\";a.click();URL.revokeObjectURL(url);});// New: copy-to-clipboard helper for the prompt\nconst copyPromptToClipboard=async()=>{try{await navigator.clipboard.writeText(measurementPrompt);// Lightweight user feedback\nalert(\"Prompt copied to clipboard\");}catch(err){// Fallback: create temporary textarea\nconst ta=document.createElement(\"textarea\");ta.value=measurementPrompt;document.body.appendChild(ta);ta.select();try{document.execCommand(\"copy\");alert(\"Prompt copied to clipboard\");}catch(_unused){alert(\"Copy failed — please select and copy manually.\");}document.body.removeChild(ta);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"app-root\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"topbar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"brand\",children:\"KPI Map Builder\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[filterNodeId&&/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>setFilterNodeId(null),children:\"Clear Filter\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"btn\",title:layoutMode!==\"island\"?\"Enable island layout to allow dragging\":\"\",style:{opacity:layoutMode===\"island\"?1:0.5,display:\"flex\",alignItems:\"center\",gap:8},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:dragToggle&&layoutMode===\"island\",disabled:layoutMode!==\"island\",onChange:e=>setDragToggle(e.target.checked)}),\"Dragging\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:relayoutAuto,title:\"Clear stored positions and re-run auto layout\",children:\"Relayout (Auto)\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:exportToPDF,children:\"Export PDF\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:exportToPNG,children:\"Export PNG\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:exportToSVG,children:\"Export SVG\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"btn\",children:[\"Import JSON\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"application/json\",style:{display:\"none\"},onChange:e=>{const f=e.target.files&&e.target.files[0];if(!f)return;const reader=new FileReader();reader.onload=ev=>{try{const parsed=JSON.parse(ev.target.result);if(!parsed||!Array.isArray(parsed.kpis))throw new Error(\"Invalid JSON\");if(!parsed.positions)parsed.positions={};setData(cleanImportedData(parsed));}catch(err){alert(\"Import failed: \"+err.message);}};reader.readAsText(f);}})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>{const blob=new Blob([JSON.stringify(data,null,2)],{type:\"application/json\"});const url=URL.createObjectURL(blob);const a=document.createElement(\"a\");a.href=url;a.download=\"kpi-map.json\";a.click();URL.revokeObjectURL(url);},children:\"Export JSON\"}),layoutMode===\"island\"&&/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>setIslandKpiId(null),children:\"Clear Focus\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"main\",children:[sidebarOpen&&/*#__PURE__*/_jsxs(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(SidebarTree,{data:data,setData:setData,onLayoutChange:m=>{setLayoutMode(m===\"island\"?\"island\":\"vertical\");if(m===\"island\"){relayoutAuto();}},layoutMode:layoutMode,onFocusIslandKpi:id=>setIslandKpiId(id),islandKpiId:islandKpiId,onCenterKpi:id=>centerOnNode(id)}),/*#__PURE__*/_jsx(JsonEditor,{data:data,setData:setData})]}),/*#__PURE__*/_jsx(\"button\",{className:\"sidebar-toggle\",onClick:()=>setSidebarOpen(!sidebarOpen),style:{left:sidebarOpen?\"360px\":\"0\"},children:sidebarOpen?\"◀\":\"▶\"}),/*#__PURE__*/_jsx(\"section\",{className:\"canvas\",ref:canvasRef,children:data.kpis.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Start building your KPI Map\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Add KPIs in the sidebar (\\u25B8 + KPI) \\u2014 the map will appear here.\"})]}):/*#__PURE__*/_jsxs(ReactFlow,{nodes:rfNodes,edges:rfEdges,edgeTypes:{floating:FloatingEdge},onInit:inst=>reactFlowInstanceRef.current=inst,onNodeClick:onNodeClick,onNodesChange:onNodesChange,onNodeDragStart:onNodeDragStart,onNodeDragStop:onNodeDragStop,nodesDraggable:dragEnabled,nodesConnectable:false,fitView:true,fitViewOptions:{padding:0.2},style:{width:\"100%\",height:\"100%\"},children:[/*#__PURE__*/_jsx(Controls,{}),/*#__PURE__*/_jsx(MiniMap,{nodeColor:n=>{var _n$style;return((_n$style=n.style)===null||_n$style===void 0?void 0:_n$style.background)||\"#888\";}}),/*#__PURE__*/_jsx(Background,{variant:BackgroundVariant.Dots,gap:16})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"prompt-panel \".concat(promptVisible?\"open\":\"closed\"),\"aria-hidden\":!promptVisible,children:!promptVisible?/*#__PURE__*/_jsx(\"button\",{className:\"prompt-toggle btn small\",onClick:()=>setPromptVisible(true),title:\"Show Measurement Framework Prompt\",children:\"Show Measurement Framework Prompt\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"prompt-content\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",gap:8},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Measurement Framework Prompt\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:6},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:copyPromptToClipboard,children:\"Copy\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>setPromptVisible(false),children:\"Hide\"})]})]}),/*#__PURE__*/_jsx(\"textarea\",{readOnly:true,value:measurementPrompt,rows:8,style:{width:\"100%\",marginTop:8,resize:\"vertical\",padding:8,background:\"#061322\",color:\"#e6eef6\",border:\"1px solid #15202b\",borderRadius:6}})]})}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        body,html,#root{height:100%;margin:0}\\n        .app-root{font-family:Inter,Arial,sans-serif;color:#e6eef6;background:#071022;min-height:100vh}\\n        .topbar{height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid #0b1220}\\n        .controls{display:flex;gap:8px;flex-wrap:wrap}\\n        .brand{font-weight:600}\\n        .btn{background:#0b1220;border:1px solid #15202b;padding:6px 10px;border-radius:6px;color:#e6eef6;cursor:pointer}\\n        .btn.small{font-size:13px;padding:4px 8px}\\n        .link{background:none;border:none;color:#7dd3fc;cursor:pointer;font-size:13px}\\n        .link.danger{color:#fb7185}\\n        .main{display:flex;height:calc(100vh - 60px);position:relative}\\n        .sidebar{width:360px;background:#071827;border-right:1px solid #0b1220;padding:14px;overflow:auto}\\n        .sidebar-toggle{position:absolute;top:50%;transform:translateY(-50%);z-index:10;background:#0b1220;border:1px solid #15202b;color:#e6eef6;padding:8px 6px;cursor:pointer;border-radius:0 6px 6px 0;transition:left 0.3s}\\n        .canvas{flex:1;padding:12px;position:relative}\\n        .muted{color:#94a3b8;font-size:13px}\\n        .empty-state{color:#9aa4b2;text-align:center;padding-top:80px}\\n        .react-flow__node{cursor:\".concat(dragEnabled?\"grab\":\"default\",\"}\\n        .export-clean .react-flow__controls,\\n        .export-clean .react-flow__minimap,\\n        .export-clean .react-flow__attribution,\\n        .export-clean .react-flow__background {\\n          display: none !important;\\n        }\\n        .export-clean .react-flow {\\n          background: #fff !important;\\n        }\\n\\n        /* Prompt panel (bottom-left) */\\n        .prompt-panel { position: fixed; left: 12px; bottom: 12px; z-index: 60; max-width: 420px; width: calc(35vw + 120px); }\\n        .prompt-panel.closed .prompt-toggle { display: inline-block; }\\n        .prompt-panel.open .prompt-toggle { display: none; }\\n        .prompt-content { background:#071827;border:1px solid #0b1220;padding:10px;border-radius:8px;box-shadow:0 6px 18px rgba(2,6,23,0.6) }\\n        .prompt-toggle{ white-space:nowrap; }\\n        @media (max-width: 900px) {\\n          .prompt-panel { width: 320px; left: 8px; bottom: 8px; }\\n        }\\n      \")})]});}export default App;","map":{"version":3,"names":["React","useEffect","useState","useRef","ReactFlow","MiniMap","Controls","Background","BackgroundVariant","MarkerType","applyNodeChanges","dagre","html2canvas","jsPDF","domtoimage","FloatingEdge","jsx","_jsx","jsxs","_jsxs","uid","prefix","arguments","length","undefined","concat","Date","now","toString","Math","floor","random","nodeWidth","nodeHeight","PAD","initialLeversData","id","name","features","rules","getDagreLayout","elements","direction","nodeSpacing","g","graphlib","Graph","setDefaultEdgeLabel","setGraph","rankdir","nodesep","ranksep","forEach","el","data","type","setNode","width","height","filter","e","source","target","edge","setEdge","layout","map","p","node","position","x","y","cleanImportedData","allNodeIds","Set","kpis","kpi","add","drivers","driver","levers","lever","positions","Object","keys","has","nodeStyle","category","background","color","padding","borderRadius","radialPositions","n","cx","cy","r","startAngle","PI","step","max","i","theta","push","cos","sin","angle","safeRadiusForArc","stepAngle","requiredArc","placeLeversNoOverlap","_ref","L","centerX","centerY","baseRadius","driverAngle","driverGapAngle","leverArcCapRatio","leverBaseArcDeg","leverArcPerItemDeg","radialGapBase","maxLocalArc","desiredLocalArcDeg","min","desiredLocalArc","remaining","ringIndex","ringRadius","minDeltaAngle","capacity","count","delta","offsetAngle","buildFlowFromData","layoutMode","filterNodeId","islandKpiId","dragEnabled","nodes","edges","positionsMap","useStored","fallback","_objectSpread","Array","isArray","addNode","label","style","tmpNodes","tmpEdges","ki","drv","di","markerEnd","ArrowClosed","lvr","li","keepIds","d","l","filteredNodes","filteredEdges","positioned","focusedKpi","find","k","nDrivers","baseR1","baseR2","driverStep","R1","dposList","dpos","driverFallback","leverPositions","idx","lp","leverFallback","LeverSelector","_ref2","onSelect","selectedLeverId","setSelectedLeverId","selectedRule","setSelectedRule","customLever","setCustomLever","selectedLever","cdhRules","flatMap","f","rule","feature","handleAddLever","replace","toLowerCase","trim","display","flexDirection","gap","marginBottom","children","value","onChange","placeholder","className","onClick","SidebarTree","_ref3","setData","onLayoutChange","onFocusIslandKpi","onCenterKpi","expanded","setExpanded","addingKpi","setAddingKpi","addingDriver","setAddingDriver","addingLever","setAddingLever","newName","setNewName","prev","next","ids","toggleExpand","s","confirmAddKpi","JSON","parse","stringify","newKpi","confirmAddDriver","kpiId","_next$positions$kpiId","_next$positions$kpiId2","newDriver","confirmAddLever","drvId","_next$positions$drvId","_next$positions$drvId2","newLever","removeKpi","confirm","_next$positions3","_next$positions2","_next$positions","kk","removeDriver","_next$positions5","_next$positions4","d0","removeLever","leverId","_next$positions6","renameNode","prompt","driverId","justifyContent","alignItems","margin","marginTop","isFocused","paddingLeft","onKeyDown","key","autoFocus","border","leverObj","_next$positions$d$id","_next$positions$d$id2","checked","JsonEditor","_ref4","open","setOpen","text","setText","apply","parsed","Error","err","alert","message","rows","fontFamily","App","setLayoutMode","rfNodes","setRfNodes","rfEdges","setRfEdges","setFilterNodeId","setIslandKpiId","sidebarOpen","setSidebarOpen","dragToggle","setDragToggle","canvasRef","reactFlowInstanceRef","isDraggingRef","promptVisible","setPromptVisible","measurementPrompt","current","onNodeClick","_event","_node$data","onNodesChange","changes","nds","onNodeDragStart","onNodeDragStop","_evt","setTimeout","centerOnNode","inst","setCenter","zoom","duration","relayoutAuto","_next$positions9","_next$positions8","_next$positions7","fitThen","fn","fitView","Promise","exportToPDF","container","document","querySelector","classList","screenshot","backgroundColor","scale","window","devicePixelRatio","useCORS","imgWidth","imgHeight","pdf","orientation","unit","format","pageWidth","internal","pageSize","getWidth","pageHeight","getHeight","targetWidth","targetPageContentHeight","sliceHeightPx","sliceCanvas","createElement","ctx","getContext","pageIndex","sliceHeight","clearRect","drawImage","imgData","toDataURL","renderedHeight","addPage","addImage","save","remove","exportToPNG","a","href","download","click","exportToSVG","dataUrl","toSvg","bgcolor","quality","cacheBust","res","fetch","blob","url","URL","createObjectURL","revokeObjectURL","copyPromptToClipboard","navigator","clipboard","writeText","ta","body","appendChild","select","execCommand","_unused","removeChild","title","opacity","disabled","accept","files","reader","FileReader","onload","ev","result","readAsText","Blob","m","left","ref","edgeTypes","floating","onInit","nodesDraggable","nodesConnectable","fitViewOptions","nodeColor","_n$style","variant","Dots","readOnly","resize"],"sources":["C:/Users/krist/Documents/KPI Map Builder v2/src/App.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport ReactFlow, {\n  MiniMap,\n  Controls,\n  Background,\n  BackgroundVariant,\n  MarkerType,\n  applyNodeChanges,\n} from \"reactflow\";\nimport dagre from \"dagre\";\nimport html2canvas from \"html2canvas\";\nimport jsPDF from \"jspdf\";\nimport domtoimage from \"dom-to-image-more\";\nimport \"reactflow/dist/style.css\";\nimport FloatingEdge from \"./FloatingEdge\";\n\n// Utils\nconst uid = (prefix = \"id\") =>\n  `${prefix}_${Date.now().toString(36)}_${Math.floor(Math.random() * 1000)}`;\n\nconst nodeWidth = 180;\nconst nodeHeight = 48;\nconst PAD = 16; // padding to prevent touching\n\n// Lever Data (unchanged)\nconst initialLeversData = [\n  {\n    id: \"lev_cdh\",\n    name: \"Customer Decision Hub\",\n    features: [\n      {\n        id: \"cdh_nba_designer\",\n        name: \"Next-Best-Action Designer\",\n        rules: [\n          \"NBA Strategies (Upsell, Cross-sell, Retention, Acquisition, Nurture, Loyalty, Onboarding, Collections)\",\n          \"Engagement Policies\",\n          \"Action Arbitration\",\n          \"Prioritization Logic\",\n          \"Eligibility Rules\",\n          \"Suppression Rules\",\n        ],\n      },\n      {\n        id: \"cdh_actions_treatments\",\n        name: \"Actions & Treatments\",\n        rules: [\n          \"Action Configuration\",\n          \"Treatment Variations (per channel)\",\n          \"Offer Bundling\",\n          \"Message Personalization\",\n          \"Channel Assignment\",\n        ],\n      },\n      {\n        id: \"cdh_analytics\",\n        name: \"Analytical Tools\",\n        rules: [\n          \"Impact Analyzer\",\n          \"Value Finder\",\n          \"Simulation Testing\",\n          \"Engagement Metrics\",\n          \"Journey Monitoring & Visualization\",\n        ],\n      },\n      {\n        id: \"cdh_ai_ml\",\n        name: \"AI & Machine Learning\",\n        rules: [\n          \"Predictive Model Building\",\n          \"Adaptive Modeling\",\n          \"Import 3rd Party Models (PMML, H2O.ai)\",\n          \"Real-Time AI Connectors (Google Cloud ML, Amazon SageMaker)\",\n          \"Natural Language Processing & Text Analytics\",\n          \"Model Transparency Controls\",\n          \"GenAI CDH Assistant\",\n        ],\n      },\n      {\n        id: \"cdh_profiles\",\n        name: \"Customer Profiles\",\n        rules: [\n          \"Customer Profile Designer\",\n          \"Customer Profile Viewer\",\n          \"Interaction History\",\n          \"Audience & Profile Data Management\",\n          \"Multi-level Customer Data Management\",\n          \"Complex Event Processing\",\n          \"Streaming Data Management\",\n        ],\n      },\n      {\n        id: \"cdh_journeys\",\n        name: \"Customer Journeys\",\n        rules: [\n          \"Next-Best-Action Customer Journeys\",\n          \"Journey Monitoring & Visualization\",\n          \"Channel, Treatment, Engagement, and Throughput Monitoring\",\n        ],\n      },\n      {\n        id: \"cdh_channels\",\n        name: \"Engagement Channels\",\n        rules: [\n          \"Inbound (Web, Mobile, ATM, Kiosk, Contact Center, Retail, Branch)\",\n          \"Outbound (Email, SMS, Direct Mail)\",\n          \"Preference Management (GDPR Compliance)\",\n          \"Real-time Web Personalization\",\n          \"Interactive Digital Microsites\",\n        ],\n      },\n      {\n        id: \"cdh_context\",\n        name: \"Context Dictionary & Switching\",\n        rules: [\n          \"Context Dictionary Configuration\",\n          \"Context Switching in Strategy Canvas\",\n          \"Multilevel Context Definition\",\n        ],\n      },\n      {\n        id: \"cdh_portal\",\n        name: \"Customer Decision Hub Portal\",\n        rules: [\n          \"Role-based Information Layout\",\n          \"Application Overview\",\n          \"Ruleset Management\",\n          \"Performance Data\",\n        ],\n      },\n    ],\n  },\n  { id: \"lev_rpa\", name: \"Robotic Process Automation\" },\n  { id: \"lev_ai\", name: \"Artificial Intelligence & Decisioning\" },\n  { id: \"lev_case_mgmt\", name: \"Case Management\" },\n  { id: \"lev_workflow\", name: \"Workflow Automation\" },\n  { id: \"lev_proc_mining\", name: \"Process Mining\" },\n  { id: \"lev_rules\", name: \"Business Rules Engine\" },\n  { id: \"lev_integration\", name: \"Integration (APIs, Connectors)\" },\n  { id: \"lev_data_mgmt\", name: \"Data Management\" },\n  { id: \"lev_uiux\", name: \"UI/UX Components\" },\n  { id: \"lev_reporting\", name: \"Reporting & Analytics\" },\n  { id: \"lev_sla\", name: \"SLA Management\" },\n  { id: \"lev_notifications\", name: \"Notifications & Alerts\" },\n  { id: \"lev_security\", name: \"Security & Access Control\" },\n  { id: \"lev_mobile\", name: \"Mobile Application Support\" },\n  { id: \"lev_multichannel\", name: \"Multi-Channel Communication\" },\n  { id: \"lev_docs\", name: \"Document Generation & Management\" },\n  { id: \"lev_audit\", name: \"Audit & Compliance Tracking\" },\n  { id: \"lev_legacy\", name: \"Legacy System Integration\" },\n  { id: \"lev_reusable\", name: \"Reusable Components\" },\n  { id: \"lev_testing\", name: \"Testing & Quality Assurance Tools\" },\n  { id: \"lev_devops\", name: \"Deployment & DevOps Tools\" },\n  { id: \"lev_portal\", name: \"User Portal & Dashboards\" },\n  { id: \"lev_exception\", name: \"Exception Handling\" },\n  { id: \"lev_case_lifecycle\", name: \"Case Lifecycle Management\" },\n  { id: \"lev_microjourney\", name: \"Microjourneys\" },\n  { id: \"lev_cust_service\", name: \"Customer Service Automation\" },\n  { id: \"lev_sales\", name: \"Sales Automation\" },\n  { id: \"lev_rda\", name: \"Robotic Desktop Automation\" },\n  { id: \"lev_knowledge\", name: \"Knowledge Management\" },\n  { id: \"lev_predictive\", name: \"Predictive Analytics\" },\n  { id: \"lev_adaptive\", name: \"Adaptive Models\" },\n  { id: \"lev_realtime\", name: \"Real-Time Event Processing\" },\n  { id: \"lev_ext_data\", name: \"External Data Integration\" },\n  { id: \"lev_data_transform\", name: \"Data Transformation\" },\n  { id: \"lev_batch\", name: \"Batch Processing\" },\n  { id: \"lev_rule_delegate\", name: \"Rule Delegation\" },\n  { id: \"lev_versioning\", name: \"Application Versioning\" },\n  { id: \"lev_change_mgmt\", name: \"Change Management\" },\n  { id: \"lev_perf_monitor\", name: \"Performance Monitoring\" },\n  { id: \"lev_kpi\", name: \"Value Measurement & KPI Tracking\" },\n];\n\nfunction getDagreLayout(elements, direction = \"TB\", nodeSpacing = 50) {\n  const g = new dagre.graphlib.Graph();\n  g.setDefaultEdgeLabel(() => ({}));\n  g.setGraph({ rankdir: direction, nodesep: nodeSpacing, ranksep: nodeSpacing });\n\n  elements.forEach((el) => {\n    if (el.data && el.data.type === \"node\") {\n      g.setNode(el.id, { width: nodeWidth, height: nodeHeight });\n    }\n  });\n\n  elements.filter((e) => e.source && e.target).forEach((edge) => g.setEdge(edge.source, edge.target));\n  dagre.layout(g);\n\n  return elements.map((el) => {\n    if (el.data && el.data.type === \"node\") {\n      const p = g.node(el.id);\n      if (p) el.position = { x: p.x - nodeWidth / 2, y: p.y - nodeHeight / 2 };\n    }\n    return el;\n  });\n}\n\nfunction cleanImportedData(data) {\n  // Collect all valid node IDs\n  const allNodeIds = new Set();\n  (data.kpis || []).forEach((kpi) => {\n    allNodeIds.add(kpi.id);\n    (kpi.drivers || []).forEach((driver) => {\n      allNodeIds.add(driver.id);\n      (driver.levers || []).forEach((lever) => {\n        allNodeIds.add(lever.id);\n      });\n    });\n  });\n  // Remove positions for missing nodes\n  if (data.positions) {\n    Object.keys(data.positions).forEach((id) => {\n      if (!allNodeIds.has(id)) {\n        delete data.positions[id];\n      }\n    });\n  }\n  return data;\n}\n\nfunction nodeStyle(category) {\n  if (category === \"kpi\")\n    return { background: \"#374151\", color: \"#fff\", padding: 10, borderRadius: 8, width: nodeWidth };\n  if (category === \"driver\")\n    return { background: \"#0d9488\", color: \"#fff\", padding: 10, borderRadius: 8, width: nodeWidth };\n  return { background: \"#f59e0b\", color: \"#042027\", padding: 10, borderRadius: 8, width: nodeWidth };\n}\n\nfunction radialPositions(n, cx, cy, r, startAngle = -Math.PI / 2) {\n  const positions = [];\n  if (n === 0) return positions;\n  const step = (2 * Math.PI) / Math.max(n, 1);\n  for (let i = 0; i < n; i++) {\n    const theta = startAngle + i * step;\n    positions.push({ x: cx + r * Math.cos(theta), y: cy + r * Math.sin(theta), angle: theta, step });\n  }\n  return positions;\n}\nconst safeRadiusForArc = (stepAngle, requiredArc) => requiredArc / Math.max(stepAngle, 1e-6);\n\n/** Multi-ring lever placement (no overlap) */\nfunction placeLeversNoOverlap({\n  L,\n  centerX,\n  centerY,\n  baseRadius,\n  driverAngle,\n  driverGapAngle,\n  leverArcCapRatio = 0.8,\n  leverBaseArcDeg = 20,\n  leverArcPerItemDeg = 10,\n  radialGapBase = nodeHeight + 28,\n}) {\n  if (L <= 0) return [];\n\n  const maxLocalArc = driverGapAngle * leverArcCapRatio;\n  const desiredLocalArcDeg = Math.min(leverBaseArcDeg + leverArcPerItemDeg * (L - 1), 140);\n  const desiredLocalArc = Math.min(maxLocalArc, (desiredLocalArcDeg * Math.PI) / 180);\n\n  if (L === 1) {\n    const r = Math.max(baseRadius, nodeWidth + PAD);\n    return [{ x: centerX + r * Math.cos(driverAngle), y: centerY + r * Math.sin(driverAngle) }];\n  }\n\n  const positions = [];\n  let remaining = L;\n  let ringIndex = 0;\n\n  while (remaining > 0 && ringIndex < 20) {\n    const ringRadius = baseRadius + ringIndex * radialGapBase;\n    const minDeltaAngle = (nodeWidth + PAD) / ringRadius;\n    let capacity = Math.max(1, Math.floor(desiredLocalArc / Math.max(minDeltaAngle, 1e-6)) + 1);\n\n    if (capacity <= 1 && desiredLocalArc > 0) {\n      ringIndex += 1;\n      continue;\n    }\n\n    const count = Math.min(remaining, capacity);\n    const delta = count > 1 ? desiredLocalArc / (count - 1) : 0;\n\n    for (let i = 0; i < count; i++) {\n      const offsetAngle = count === 1 ? 0 : -desiredLocalArc / 2 + i * delta;\n      const theta = driverAngle + offsetAngle;\n      positions.push({\n        x: centerX + ringRadius * Math.cos(theta),\n        y: centerY + ringRadius * Math.sin(theta),\n      });\n    }\n    remaining -= count;\n    ringIndex += 1;\n  }\n\n  return positions;\n}\n\n/** Build nodes/edges; respects stored positions when dragEnabled (skip auto layout) */\nfunction buildFlowFromData(\n  data,\n  layoutMode = \"vertical\",\n  filterNodeId = null,\n  islandKpiId = null,\n  dragEnabled = false\n) {\n  const nodes = [];\n  const edges = [];\n  const positionsMap = data.positions || {};\n  const useStored = (id, fallback) => (positionsMap && positionsMap[id] ? { ...positionsMap[id] } : fallback);\n\n  if (!data || !Array.isArray(data.kpis)) return { nodes, edges };\n\n  // Helper to add node safely\n  const addNode = (id, label, category, fallback) => {\n    nodes.push({\n      id,\n      data: { label, type: \"node\", category },\n      position: useStored(id, fallback),\n      style: nodeStyle(category),\n    });\n  };\n\n  // Build full vertical layout\n  if (layoutMode === \"vertical\") {\n    const tmpNodes = [];\n    const tmpEdges = [];\n\n    data.kpis.forEach((kpi, ki) => {\n      tmpNodes.push({\n        id: kpi.id,\n        data: { label: kpi.name, type: \"node\", category: \"kpi\" },\n        position: useStored(kpi.id, { x: 100 + ki * 40, y: 80 + ki * 20 }),\n        style: nodeStyle(\"kpi\"),\n      });\n      (kpi.drivers || []).forEach((drv, di) => {\n        tmpNodes.push({\n          id: drv.id,\n          data: { label: drv.name, type: \"node\", category: \"driver\" },\n          position: useStored(drv.id, { x: 420 + di * 40, y: 160 + di * 50 }),\n          style: nodeStyle(\"driver\"),\n        });\n        tmpEdges.push({\n          id: `e-${kpi.id}-${drv.id}`,\n          source: kpi.id,\n          target: drv.id,\n          type: \"floating\",\n          markerEnd: { type: MarkerType.ArrowClosed },\n        });\n        (drv.levers || []).forEach((lvr, li) => {\n          tmpNodes.push({\n            id: lvr.id,\n            data: { label: lvr.name, type: \"node\", category: \"lever\" },\n            position: useStored(lvr.id, { x: 740 + li * 40, y: 160 + di * 50 + li * 10 }),\n            style: nodeStyle(\"lever\"),\n          });\n          tmpEdges.push({\n            id: `e-${drv.id}-${lvr.id}`,\n            source: drv.id,\n            target: lvr.id,\n            type: \"floating\",\n            markerEnd: { type: MarkerType.ArrowClosed },\n          });\n        });\n      });\n    });\n\n    // If filterNodeId present, filter nodes/edges to the relevant subgraph\n    if (filterNodeId) {\n      const keepIds = new Set();\n      // find KPI or driver that matches filterNodeId\n      data.kpis.forEach((kpi) => {\n        if (kpi.id === filterNodeId) {\n          keepIds.add(kpi.id);\n          (kpi.drivers || []).forEach((d) => {\n            keepIds.add(d.id);\n            (d.levers || []).forEach((l) => keepIds.add(l.id));\n          });\n        } else {\n          (kpi.drivers || []).forEach((d) => {\n            if (d.id === filterNodeId) {\n              keepIds.add(kpi.id);\n              keepIds.add(d.id);\n              (d.levers || []).forEach((l) => keepIds.add(l.id));\n            }\n          });\n        }\n      });\n      // filter\n      const filteredNodes = tmpNodes.filter((n) => keepIds.has(n.id));\n      const filteredEdges = tmpEdges.filter((e) => keepIds.has(e.source) && keepIds.has(e.target));\n      if (dragEnabled) return { nodes: filteredNodes, edges: filteredEdges };\n      const positioned = getDagreLayout([...filteredNodes, ...filteredEdges], \"TB\");\n      return {\n        nodes: positioned.filter((n) => n.data && n.data.type === \"node\"),\n        edges: positioned.filter((e) => e.source && e.target),\n      };\n    }\n\n    if (dragEnabled) return { nodes: tmpNodes, edges: tmpEdges };\n\n    const positioned = getDagreLayout([...tmpNodes, ...tmpEdges], \"TB\");\n    return {\n      nodes: positioned.filter((n) => n.data && n.data.type === \"node\"),\n      edges: positioned.filter((e) => e.source && e.target),\n    };\n  }\n\n  // === Island (radial, single KPI focus) ===\n  const focusedKpi = islandKpiId ? data.kpis.find((k) => k.id === islandKpiId) : data.kpis[0];\n  if (!focusedKpi) return { nodes, edges };\n\n  const centerX = 720,\n    centerY = 420;\n  addNode(\n    focusedKpi.id,\n    focusedKpi.name,\n    \"kpi\",\n    { x: centerX - nodeWidth / 2, y: centerY - nodeHeight / 2 }\n  );\n\n  const nDrivers = (focusedKpi.drivers || []).length;\n  if (nDrivers > 0) {\n    const baseR1 = 200,\n      baseR2 = baseR1 + 220;\n    const driverStep = (2 * Math.PI) / nDrivers;\n    const R1 = Math.max(baseR1, safeRadiusForArc(driverStep, nodeWidth + PAD));\n    const dposList = radialPositions(nDrivers, centerX, centerY, R1);\n\n    focusedKpi.drivers.forEach((drv, di) => {\n      const dpos = dposList[di],\n        angle = dpos.angle;\n      const driverFallback = { x: dpos.x - nodeWidth / 2, y: dpos.y - nodeHeight / 2 };\n\n      addNode(drv.id, drv.name, \"driver\", driverFallback);\n      edges.push({\n        id: `e-${focusedKpi.id}-${drv.id}`,\n        source: focusedKpi.id,\n        target: drv.id,\n        type: \"floating\",\n        markerEnd: { type: MarkerType.ArrowClosed },\n      });\n\n      const leverPositions = placeLeversNoOverlap({\n        L: (drv.levers || []).length,\n        centerX,\n        centerY,\n        baseRadius: baseR2,\n        driverAngle: angle,\n        driverGapAngle: dpos.step,\n      });\n\n      (drv.levers || []).forEach((lvr, idx) => {\n        const lp = leverPositions[idx];\n        const leverFallback = lp\n          ? { x: lp.x - nodeWidth / 2, y: lp.y - nodeHeight / 2 }\n          : { x: dpos.x - nodeWidth / 2 + 260, y: dpos.y - nodeHeight / 2 };\n\n        addNode(lvr.id, lvr.name, \"lever\", leverFallback);\n        edges.push({\n          id: `e-${drv.id}-${lvr.id}`,\n          source: drv.id,\n          target: lvr.id,\n          type: \"floating\",\n          markerEnd: { type: MarkerType.ArrowClosed },\n        });\n      });\n    });\n  }\n\n  return { nodes, edges };\n}\n\nfunction LeverSelector({ onSelect }) {\n  const [selectedLeverId, setSelectedLeverId] = React.useState(\"\");\n  const [selectedRule, setSelectedRule] = React.useState(\"\");\n  const [customLever, setCustomLever] = React.useState(\"\");\n\n  // Find the selected lever object\n  const selectedLever = initialLeversData.find((l) => l.id === selectedLeverId);\n\n  // If CDH is selected, flatten all rules under its features\n  const cdhRules =\n    selectedLever?.id === \"lev_cdh\"\n      ? selectedLever.features.flatMap((f) =>\n          f.rules.map((rule) => ({\n            feature: f.name,\n            rule,\n          }))\n        )\n      : [];\n\n  const handleAddLever = () => {\n    if (selectedLeverId === \"lev_cdh\" && selectedRule) {\n      onSelect({\n        id: `cdh_${selectedRule.replace(/\\s+/g, \"_\").toLowerCase()}`,\n        name: `CDH: ${selectedRule}`,\n      });\n      setSelectedLeverId(\"\");\n      setSelectedRule(\"\");\n      setCustomLever(\"\");\n    } else if (selectedLeverId && selectedLeverId !== \"lev_cdh\") {\n      onSelect(selectedLever);\n      setSelectedLeverId(\"\");\n      setSelectedRule(\"\");\n      setCustomLever(\"\");\n    } else if (customLever.trim()) {\n      onSelect({ id: `custom_${Date.now()}`, name: customLever });\n      setCustomLever(\"\");\n      setSelectedLeverId(\"\");\n      setSelectedRule(\"\");\n    }\n  };\n\n  return (\n    <div style={{ display: \"flex\", flexDirection: \"column\", gap: 8, marginBottom: 8 }}>\n      <select\n        value={selectedLeverId}\n        onChange={(e) => {\n          setSelectedLeverId(e.target.value);\n          setSelectedRule(\"\");\n        }}\n      >\n        <option value=\"\">Select a predefined lever</option>\n        {initialLeversData.map((lever) => (\n          <option key={lever.id} value={lever.id}>\n            {lever.name}\n          </option>\n        ))}\n      </select>\n      {/* If CDH is selected, show rules dropdown */}\n      {selectedLeverId === \"lev_cdh\" && (\n        <select value={selectedRule} onChange={(e) => setSelectedRule(e.target.value)}>\n          <option value=\"\">Select a CDH rule/feature</option>\n          {cdhRules.map((r, idx) => (\n            <option key={idx} value={r.rule}>\n              {r.feature}: {r.rule}\n            </option>\n          ))}\n        </select>\n      )}\n      {/* Free text entry below the selects */}\n      <input\n        type=\"text\"\n        placeholder=\"Or enter a custom lever\"\n        value={customLever}\n        onChange={(e) => setCustomLever(e.target.value)}\n      />\n      <button className=\"btn small\" onClick={handleAddLever}>\n        Add\n      </button>\n    </div>\n  );\n}\n\nfunction SidebarTree({\n  data,\n  setData,\n  onLayoutChange,\n  layoutMode,\n  onFocusIslandKpi,\n  islandKpiId,\n  onCenterKpi,\n}) {\n  const [expanded, setExpanded] = useState({});\n  const [addingKpi, setAddingKpi] = useState(false);\n  const [addingDriver, setAddingDriver] = useState(null);\n  const [addingLever, setAddingLever] = useState(null);\n  const [newName, setNewName] = useState(\"\");\n\n  useEffect(() => {\n    setExpanded((prev) => {\n      const next = { ...prev };\n      const ids = new Set((data.kpis || []).map((k) => k.id));\n      Object.keys(next).forEach((id) => {\n        if (!ids.has(id)) delete next[id];\n      });\n      (data.kpis || []).forEach((k) => {\n        if (!(k.id in next)) next[k.id] = false;\n      });\n      return next;\n    });\n  }, [data.kpis]);\n\n  function toggleExpand(id) {\n    setExpanded((s) => ({ ...s, [id]: !s[id] }));\n  }\n\n  function confirmAddKpi() {\n    if (!newName.trim()) return;\n    const next = JSON.parse(JSON.stringify(data));\n    const newKpi = { id: uid(\"kpi\"), name: newName.trim(), drivers: [] };\n    next.kpis.push(newKpi);\n    next.positions = next.positions || {};\n    next.positions[newKpi.id] = { x: 120, y: 120 };\n    setData(next);\n    setExpanded((prev) => ({ ...prev, [newKpi.id]: true }));\n    setAddingKpi(false);\n    setNewName(\"\");\n  }\n  function confirmAddDriver(kpiId) {\n    if (!newName.trim()) return;\n    const next = JSON.parse(JSON.stringify(data));\n    const k = next.kpis.find((x) => x.id === kpiId);\n    const newDriver = { id: uid(\"drv\"), name: newName.trim(), levers: [] };\n    k.drivers.push(newDriver);\n    next.positions = next.positions || {};\n    next.positions[newDriver.id] = {\n      x: (next.positions[kpiId]?.x || 200) + 220,\n      y: (next.positions[kpiId]?.y || 200),\n    };\n    setData(next);\n    setAddingDriver(null);\n    setNewName(\"\");\n  }\n  function confirmAddLever(kpiId, drvId) {\n    if (!newName.trim()) return;\n    const next = JSON.parse(JSON.stringify(data));\n    const k = next.kpis.find((x) => x.id === kpiId);\n    const d = k.drivers.find((x) => x.id === drvId);\n    const newLever = { id: uid(\"lvr\"), name: newName.trim() };\n    d.levers.push(newLever);\n    next.positions = next.positions || {};\n    next.positions[newLever.id] = {\n      x: (next.positions[drvId]?.x || 400) + 220,\n      y: (next.positions[drvId]?.y || 200),\n    };\n    setData(next);\n    setAddingLever(null);\n    setNewName(\"\");\n  }\n\n  function removeKpi(kpiId) {\n    if (!confirm(\"Remove KPI and all children?\")) return;\n    const next = JSON.parse(JSON.stringify(data));\n    const k = next.kpis.find((x) => x.id === kpiId);\n    if (k) {\n      k.drivers.forEach((d) => {\n        d.levers.forEach((l) => delete next.positions?.[l.id]);\n        delete next.positions?.[d.id];\n      });\n      delete next.positions?.[k.id];\n    }\n    next.kpis = next.kpis.filter((kk) => kk.id !== kpiId);\n    setData(next);\n    onFocusIslandKpi(null);\n    setExpanded((prev) => {\n      const p = { ...prev };\n      delete p[kpiId];\n      return p;\n    });\n  }\n  function removeDriver(kpiId, drvId) {\n    if (!confirm(\"Remove Driver and its levers?\")) return;\n    const next = JSON.parse(JSON.stringify(data));\n    const k = next.kpis.find((x) => x.id === kpiId);\n    const d = k.drivers.find((x) => x.id === drvId);\n    d.levers.forEach((l) => delete next.positions?.[l.id]);\n    k.drivers = k.drivers.filter((d0) => d0.id !== drvId);\n    delete next.positions?.[drvId];\n    setData(next);\n  }\n  function removeLever(kpiId, drvId, leverId) {\n    if (!confirm(\"Remove Lever?\")) return;\n    const next = JSON.parse(JSON.stringify(data));\n    const k = next.kpis.find((x) => x.id === kpiId);\n    const d = k.drivers.find((x) => x.id === drvId);\n    d.levers = d.levers.filter((l) => l.id !== leverId);\n    delete next.positions?.[leverId];\n    setData(next);\n  }\n\n  function renameNode(type, ids) {\n    const name = prompt(\"New name\");\n    if (!name) return;\n    const next = JSON.parse(JSON.stringify(data));\n    if (type === \"kpi\") {\n      next.kpis.find((x) => x.id === ids.kpiId).name = name;\n    } else if (type === \"driver\") {\n      const k = next.kpis.find((x) => x.id === ids.kpiId);\n      k.drivers.find((x) => x.id === ids.driverId).name = name;\n    } else {\n      const k = next.kpis.find((x) => x.id === ids.kpiId);\n      const d = k.drivers.find((x) => x.id === ids.driverId);\n      d.levers.find((x) => x.id === ids.leverId).name = name;\n    }\n    setData(next);\n  }\n\n  return (\n    <div>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n        <h4 style={{ margin: 0 }}>KPIs</h4>\n        <div style={{ display: \"flex\", gap: 8 }}>\n          <button className=\"btn small\" onClick={() => { setAddingKpi(true); setNewName(\"\"); }}>\n            + KPI\n          </button>\n        </div>\n      </div>\n\n      <div style={{ marginTop: 8 }}>\n        {data.kpis.length === 0 && <div className=\"muted\">No KPIs yet — add one to get started.</div>}\n        {data.kpis.map((k) => {\n          const isFocused = islandKpiId === k.id;\n          return (\n            <div key={k.id} style={{ marginBottom: 8, borderRadius: 6, background: \"#0f1724\", padding: 8 }}>\n              <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n                <div style={{ display: \"flex\", gap: 8, alignItems: \"center\" }}>\n                  <button className=\"link\" onClick={() => toggleExpand(k.id)}>{expanded[k.id] ? \"▾\" : \"▸\"}</button>\n                  <button className=\"link\" onClick={() => onCenterKpi(k.id)}>\n                    <strong style={{ color: \"#e6eef6\" }}>{k.name}</strong>\n                  </button>\n                  {layoutMode === \"island\" && (\n                    <small style={{ color: isFocused ? \"#7dd3fc\" : \"#94a3b8\" }}>{isFocused ? \" (focused)\" : \"\"}</small>\n                  )}\n                </div>\n                <div style={{ display: \"flex\", gap: 6 }}>\n                  <button className=\"link\" onClick={() => { onFocusIslandKpi(k.id); onCenterKpi(k.id); }}>Focus</button>\n                  <button className=\"link\" onClick={() => renameNode(\"kpi\", { kpiId: k.id })}>Rename</button>\n                  <button className=\"link\" onClick={() => { setAddingDriver(k.id); setNewName(\"\"); }}>+Drv</button>\n                  <button className=\"link danger\" onClick={() => removeKpi(k.id)}>Del</button>\n                </div>\n              </div>\n\n              {expanded[k.id] && (\n                <div style={{ marginTop: 8, paddingLeft: 18 }}>\n                  {addingDriver === k.id && (\n                    <div style={{ marginBottom: 8, padding: 6, background: \"#081222\", borderRadius: 6 }}>\n                      <input\n                        type=\"text\"\n                        placeholder=\"Driver name\"\n                        value={newName}\n                        onChange={(e) => setNewName(e.target.value)}\n                        onKeyDown={(e) => e.key === \"Enter\" && confirmAddDriver(k.id)}\n                        autoFocus\n                        style={{ width: \"100%\", padding: 6, background: \"#061322\", border: \"1px solid #15202b\", borderRadius: 4, color: \"#e6eef6\", marginBottom: 6 }}\n                      />\n                      <div style={{ display: \"flex\", gap: 6 }}>\n                        <button className=\"btn small\" onClick={() => confirmAddDriver(k.id)}>Add</button>\n                        <button className=\"btn small\" onClick={() => { setAddingDriver(null); setNewName(\"\"); }}>Cancel</button>\n                      </div>\n                    </div>\n                  )}\n\n                  {k.drivers.length === 0 && !addingDriver && <div className=\"muted\">No Drivers</div>}\n                  {k.drivers.map((d) => (\n                    <div key={d.id} style={{ marginBottom: 6, padding: 6, borderRadius: 6, background: \"#081222\" }}>\n                      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n                        <div style={{ display: \"flex\", gap: 8, alignItems: \"center\" }}>\n                          <small style={{ color: \"#cfeef8\" }}>{d.name}</small>\n                        </div>\n                        <div style={{ display: \"flex\", gap: 6 }}>\n                          <button className=\"link\" onClick={() => renameNode(\"driver\", { kpiId: k.id, driverId: d.id })}>Rename</button>\n                          <button className=\"link\" onClick={() => { setAddingLever({ kpiId: k.id, drvId: d.id }); setNewName(\"\"); }}>+Lvr</button>\n                          <button className=\"link danger\" onClick={() => removeDriver(k.id, d.id)}>Del</button>\n                        </div>\n                      </div>\n\n                      <div style={{ marginTop: 6, paddingLeft: 12 }}>\n                        {addingLever?.kpiId === k.id && addingLever?.drvId === d.id && (\n                          <LeverSelector\n                            onSelect={(leverObj) => {\n                              const next = JSON.parse(JSON.stringify(data));\n                              const kpi = next.kpis.find((x) => x.id === k.id);\n                              const drv = kpi.drivers.find((x) => x.id === d.id);\n                              drv.levers.push({ id: leverObj.id, name: leverObj.name });\n                              next.positions = next.positions || {};\n                              next.positions[leverObj.id] = {\n                                x: (next.positions[d.id]?.x || 400) + 220,\n                                y: (next.positions[d.id]?.y || 200),\n                              };\n                              setData(next);\n                              setAddingLever(null);\n                              setNewName(\"\");\n                            }}\n                          />\n                        )}\n\n                        {d.levers.length === 0 && !addingLever && <div className=\"muted\">No Levers</div>}\n                        {d.levers.map((l) => (\n                          <div key={l.id} style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 4 }}>\n                            <small>{l.name}</small>\n                            <div style={{ display: \"flex\", gap: 6 }}>\n                              <button className=\"link\" onClick={() => renameNode(\"lever\", { kpiId: k.id, driverId: d.id, leverId: l.id })}>Rename</button>\n                              <button className=\"link danger\" onClick={() => removeLever(k.id, d.id, l.id)}>Del</button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      {addingKpi && (\n        <div style={{ marginTop: 8, padding: 8, background: \"#0f1724\", borderRadius: 6 }}>\n          <input\n            type=\"text\"\n            placeholder=\"KPI name\"\n            value={newName}\n            onChange={(e) => setNewName(e.target.value)}\n            onKeyDown={(e) => e.key === \"Enter\" && confirmAddKpi()}\n            autoFocus\n            style={{ width: \"100%\", padding: 6, background: \"#081222\", border: \"1px solid #15202b\", borderRadius: 4, color: \"#e6eef6\", marginBottom: 6 }}\n          />\n          <div style={{ display: \"flex\", gap: 6 }}>\n            <button className=\"btn small\" onClick={confirmAddKpi}>Add</button>\n            <button className=\"btn small\" onClick={() => { setAddingKpi(false); setNewName(\"\"); }}>Cancel</button>\n          </div>\n        </div>\n      )}\n\n      <div style={{ marginTop: 12 }}>\n        <label style={{ display: \"flex\", alignItems: \"center\", gap: 8 }}>\n          <input\n            type=\"checkbox\"\n            checked={layoutMode === \"island\"}\n            onChange={(e) => onLayoutChange(e.target.checked ? \"island\" : \"vertical\")}\n          />\n          <small>Island (radial) layout — single KPI focus</small>\n        </label>\n        {layoutMode === \"island\" && (\n          <div className=\"muted\" style={{ marginTop: 6 }}>\n            Click a KPI name and press <em>Focus</em> to set the island focus.\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction JsonEditor({ data, setData }) {\n  const [open, setOpen] = useState(false);\n  const [text, setText] = useState(JSON.stringify(data, null, 2));\n  useEffect(() => {\n    setText(JSON.stringify(data, null, 2));\n  }, [data]);\n\n  function apply() {\n    try {\n      const parsed = JSON.parse(text);\n      if (!parsed || !Array.isArray(parsed.kpis)) throw new Error(\"Root must have kpis array\");\n      if (!parsed.positions) parsed.positions = {};\n      setData(cleanImportedData(parsed));\n    } catch (err) {\n      alert(\"Invalid JSON: \" + err.message);\n    }\n  }\n\n  return (\n    <div style={{ marginTop: 12 }}>\n      <button className=\"btn small\" onClick={() => setOpen(!open)}>{open ? \"Hide JSON Editor\" : \"Show JSON Editor\"}</button>\n      {open && (\n        <div style={{ marginTop: 8 }}>\n          <textarea\n            value={text}\n            onChange={(e) => setText(e.target.value)}\n            rows={10}\n            style={{ width: \"100%\", fontFamily: \"monospace\", background: \"#061322\", color: \"#e6eef6\", borderRadius: 6, padding: 8 }}\n          />\n          <div style={{ display: \"flex\", gap: 8, marginTop: 6 }}>\n            <button className=\"btn small\" onClick={apply}>Apply JSON</button>\n            <button className=\"btn small\" onClick={() => setText(JSON.stringify({ kpis: [], positions: {} }, null, 2))}>\n              Reset to empty\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction App() {\n  const [data, setData] = useState({ kpis: [], positions: {} });\n  const [layoutMode, setLayoutMode] = useState(\"vertical\");\n  const [rfNodes, setRfNodes] = useState([]);\n  const [rfEdges, setRfEdges] = useState([]);\n  const [filterNodeId, setFilterNodeId] = useState(null);\n  const [islandKpiId, setIslandKpiId] = useState(null);\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const [dragToggle, setDragToggle] = useState(false); // user toggle\n  const canvasRef = useRef(null);\n  const reactFlowInstanceRef = useRef(null);\n  const isDraggingRef = useRef(false); // guard rebuilds during drag\n\n  // New: prompt panel state + the predefined prompt text\n  const [promptVisible, setPromptVisible] = useState(false);\n  const measurementPrompt = `You are acting as a domain expert assistant embedded in a KPI mapping application. Your role is to analyze structured input (JSON) that maps KPIs to their drivers and associated Pega functionalities (\"levers\") and generate a tailored measurement framework for each KPI.\nPlease prioritize your response based on the following:\n\nUse the JSON structure as your primary knowledge source. It defines the KPI hierarchy and the Pega levers that influence each driver.\nUse https://docs.pega.com as a preferred reference for implementation details, best practices, and component usage within Pega.\nYou may also draw from broader domain knowledge in enterprise performance management, customer experience, and intelligent automation where relevant and helpful—but clearly distinguish when insights are based on general best practices vs. Pega-specific capabilities.\nAct as a Pega implementation strategist. Your suggestions should reflect how a Pega architect or business analyst would design data collection, reporting, and automation for each KPI.\nBe specific and actionable. Avoid generic advice. Provide concrete data points, metrics, and implementation ideas using Pega components (e.g., case types, adaptive models, decision tables, CDH strategies).\nInclude strategic best practices for tracking and improving KPI performance, such as:\n\nDesigning closed-loop feedback systems using adaptive analytics and interaction history\nEnsuring data quality and governance across channels and case types\nUsing real-time monitoring, alerts, and thresholds to proactively manage KPI performance\nAligning KPI tracking with business goals, operational workflows, and customer journeys\nApplying continuous improvement using performance insights to refine strategies, rules, and models\nLeveraging Pega’s AI and decisioning capabilities to automate and optimize interventions\n\nHere is the JSON structure to analyze:`;\n\n  const dragEnabled = layoutMode === \"island\" && dragToggle; // only allow in island\n\n  // Build nodes/edges (skip while dragging to avoid flicker/disappear)\n  useEffect(() => {\n    if (isDraggingRef.current) return;\n    const { nodes, edges } = buildFlowFromData(\n      data,\n      layoutMode === \"vertical\" ? \"vertical\" : \"island\",\n      filterNodeId,\n      islandKpiId,\n      dragEnabled\n    );\n    setRfNodes(nodes);\n    setRfEdges(edges);\n  }, [data, layoutMode, filterNodeId, islandKpiId, dragEnabled]);\n\n  // Toggle filter on click (unchanged)\n  const onNodeClick = (_event, node) => {\n    if (node?.data?.category === \"lever\") return;\n    setFilterNodeId((prev) => (node.id === prev ? null : node.id));\n  };\n\n  // Live drag updates: keep visual in sync without touching data (prevents rebuild mid-drag)\n  const onNodesChange = (changes) => {\n    if (!dragEnabled) return;\n    if (!changes || changes.length === 0) return;\n    setRfNodes((nds) => applyNodeChanges(changes, nds));\n  };\n\n  // Persist final position on drag stop (single node)\n  const onNodeDragStart = () => {\n    if (dragEnabled) isDraggingRef.current = true;\n  };\n  const onNodeDragStop = (_evt, node) => {\n    if (!dragEnabled || !node?.id) {\n      isDraggingRef.current = false;\n      return;\n    }\n    setData((prev) => {\n      const next = JSON.parse(JSON.stringify(prev));\n      next.positions = next.positions || {};\n      next.positions[node.id] = { x: node.position.x, y: node.position.y };\n      return next;\n    });\n    // allow rebuild after data update settles\n    setTimeout(() => {\n      isDraggingRef.current = false;\n    }, 0);\n  };\n\n  // Center viewport on a node\n  const centerOnNode = (id) => {\n    const inst = reactFlowInstanceRef.current;\n    if (!inst) return;\n    const node = rfNodes.find((n) => n.id === id);\n    if (!node) return;\n    inst.setCenter(node.position.x + nodeWidth / 2, node.position.y + nodeHeight / 2, { zoom: 1.2, duration: 300 });\n  };\n\n  // Relayout (Auto) – clear positions then rebuild\n  const relayoutAuto = () => {\n    setData((prev) => {\n      const next = JSON.parse(JSON.stringify(prev));\n      if (layoutMode === \"vertical\") {\n        next.positions = {};\n      } else {\n        if (islandKpiId) {\n          const k = next.kpis.find((x) => x.id === islandKpiId);\n          if (k) {\n            k.drivers.forEach((d) => {\n              d.levers.forEach((l) => delete next.positions?.[l.id]);\n              delete next.positions?.[d.id];\n            });\n            delete next.positions?.[k.id];\n          }\n        } else {\n          next.positions = {};\n        }\n      }\n      return next;\n    });\n  };\n\n  // Exports (unchanged)\n  const fitThen = async (fn) => {\n    if (reactFlowInstanceRef.current) {\n      reactFlowInstanceRef.current.fitView({ padding: 0.2, duration: 0 });\n      await new Promise((r) => setTimeout(r, 50));\n    }\n    return fn();\n  };\n\n  const exportToPDF = () =>\n    fitThen(async () => {\n      const container = document.querySelector(\".react-flow\");\n      container.classList.add(\"export-clean\");\n      if (!container) return;\n      const screenshot = await html2canvas(container, { backgroundColor: \"#fff\", scale: window.devicePixelRatio * 2, useCORS: true });\n      const imgWidth = screenshot.width,\n        imgHeight = screenshot.height;\n      const pdf = new jsPDF({ orientation: \"portrait\", unit: \"px\", format: \"a4\" });\n      const pageWidth = pdf.internal.pageSize.getWidth(),\n        pageHeight = pdf.internal.pageSize.getHeight();\n      const margin = 20,\n        targetWidth = pageWidth - margin * 2,\n        scale = targetWidth / imgWidth;\n      const targetPageContentHeight = pageHeight - margin * 2,\n        sliceHeightPx = targetPageContentHeight / scale;\n      const sliceCanvas = document.createElement(\"canvas\");\n      const ctx = sliceCanvas.getContext(\"2d\");\n      let y = 0,\n        pageIndex = 0;\n      while (y < imgHeight) {\n        const sliceHeight = Math.min(sliceHeightPx, imgHeight - y);\n        sliceCanvas.width = imgWidth;\n        sliceCanvas.height = sliceHeight;\n        ctx.clearRect(0, 0, sliceCanvas.width, sliceCanvas.height);\n        ctx.drawImage(screenshot, 0, y, imgWidth, sliceHeight, 0, 0, imgWidth, sliceHeight);\n        const imgData = sliceCanvas.toDataURL(\"image/png\");\n        const renderedHeight = sliceHeight * scale;\n        if (pageIndex > 0) pdf.addPage();\n        pdf.addImage(imgData, \"PNG\", margin, margin, targetWidth, renderedHeight);\n        y += sliceHeightPx;\n        pageIndex += 1;\n      }\n      pdf.save(\"kpi-map.pdf\");\n      container.classList.remove(\"export-clean\");\n    });\n\n  const exportToPNG = () =>\n    fitThen(async () => {\n      const container = document.querySelector(\".react-flow\");\n      container.classList.add(\"export-clean\");\n      if (!container) return;\n      const screenshot = await html2canvas(container, { backgroundColor: \"#fff\", scale: window.devicePixelRatio * 2, useCORS: true });\n      container.classList.remove(\"export-clean\");\n      const a = document.createElement(\"a\");\n      a.href = screenshot.toDataURL(\"image/png\");\n      a.download = \"kpi-map.png\";\n      a.click();\n    });\n\n  const exportToSVG = () =>\n    fitThen(async () => {\n      const container = document.querySelector(\".react-flow\");\n      container.classList.add(\"export-clean\");\n      if (!container) return;\n      const dataUrl = await domtoimage.toSvg(container, { bgcolor: \"transparent\", quality: 1, cacheBust: true });\n      container.classList.remove(\"export-clean\");\n      const res = await fetch(dataUrl);\n      const blob = await res.blob();\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = \"kpi-map.svg\";\n      a.click();\n      URL.revokeObjectURL(url);\n    });\n\n  // New: copy-to-clipboard helper for the prompt\n  const copyPromptToClipboard = async () => {\n    try {\n      await navigator.clipboard.writeText(measurementPrompt);\n      // Lightweight user feedback\n      alert(\"Prompt copied to clipboard\");\n    } catch (err) {\n      // Fallback: create temporary textarea\n      const ta = document.createElement(\"textarea\");\n      ta.value = measurementPrompt;\n      document.body.appendChild(ta);\n      ta.select();\n      try {\n        document.execCommand(\"copy\");\n        alert(\"Prompt copied to clipboard\");\n      } catch {\n        alert(\"Copy failed — please select and copy manually.\");\n      }\n      document.body.removeChild(ta);\n    }\n  };\n\n  return (\n    <div className=\"app-root\">\n      <header className=\"topbar\">\n        <div className=\"brand\">KPI Map Builder</div>\n        <div className=\"controls\">\n          {filterNodeId && <button className=\"btn\" onClick={() => setFilterNodeId(null)}>Clear Filter</button>}\n\n          {/* Drag toggle only allowed in island mode */}\n          <label className=\"btn\" title={layoutMode !== \"island\" ? \"Enable island layout to allow dragging\" : \"\"} style={{ opacity: layoutMode === \"island\" ? 1 : 0.5, display: \"flex\", alignItems: \"center\", gap: 8 }}>\n            <input\n              type=\"checkbox\"\n              checked={dragToggle && layoutMode === \"island\"}\n              disabled={layoutMode !== \"island\"}\n              onChange={(e) => setDragToggle(e.target.checked)}\n            />\n            Dragging\n          </label>\n          <button className=\"btn\" onClick={relayoutAuto} title=\"Clear stored positions and re-run auto layout\">Relayout (Auto)</button>\n\n          <button className=\"btn\" onClick={exportToPDF}>Export PDF</button>\n          <button className=\"btn\" onClick={exportToPNG}>Export PNG</button>\n          <button className=\"btn\" onClick={exportToSVG}>Export SVG</button>\n\n          <label className=\"btn\">\n            Import JSON\n            <input\n              type=\"file\"\n              accept=\"application/json\"\n              style={{ display: \"none\" }}\n              onChange={(e) => {\n                const f = e.target.files && e.target.files[0];\n                if (!f) return;\n                const reader = new FileReader();\n                reader.onload = (ev) => {\n                  try {\n                    const parsed = JSON.parse(ev.target.result);\n                    if (!parsed || !Array.isArray(parsed.kpis)) throw new Error(\"Invalid JSON\");\n                    if (!parsed.positions) parsed.positions = {};\n                    setData(cleanImportedData(parsed));\n                  } catch (err) { alert(\"Import failed: \" + err.message); }\n                };\n                reader.readAsText(f);\n              }}\n            />\n          </label>\n          <button\n            className=\"btn\"\n            onClick={() => {\n              const blob = new Blob([JSON.stringify(data, null, 2)], { type: \"application/json\" });\n              const url = URL.createObjectURL(blob);\n              const a = document.createElement(\"a\");\n              a.href = url;\n              a.download = \"kpi-map.json\";\n              a.click();\n              URL.revokeObjectURL(url);\n            }}\n          >\n            Export JSON\n          </button>\n\n          {layoutMode === \"island\" && <button className=\"btn\" onClick={() => setIslandKpiId(null)}>Clear Focus</button>}\n        </div>\n      </header>\n\n      <div className=\"main\">\n        {sidebarOpen && (\n          <aside className=\"sidebar\">\n            <SidebarTree\n              data={data}\n              setData={setData}\n              onLayoutChange={(m) => {\n                setLayoutMode(m === \"island\" ? \"island\" : \"vertical\");\n                if (m === \"island\") {\n                  relayoutAuto();\n                }\n              }}\n              layoutMode={layoutMode}\n              onFocusIslandKpi={(id) => setIslandKpiId(id)}\n              islandKpiId={islandKpiId}\n              onCenterKpi={(id) => centerOnNode(id)}\n            />\n            <JsonEditor data={data} setData={setData} />\n          </aside>\n        )}\n\n        <button className=\"sidebar-toggle\" onClick={() => setSidebarOpen(!sidebarOpen)} style={{ left: sidebarOpen ? \"360px\" : \"0\" }}>\n          {sidebarOpen ? \"◀\" : \"▶\"}\n        </button>\n\n        <section className=\"canvas\" ref={canvasRef}>\n          {data.kpis.length === 0 ? (\n            <div className=\"empty-state\">\n              <h2>Start building your KPI Map</h2>\n              <p>Add KPIs in the sidebar (▸ + KPI) — the map will appear here.</p>\n            </div>\n          ) : (\n            <ReactFlow\n              nodes={rfNodes}\n              edges={rfEdges}\n              edgeTypes={{ floating: FloatingEdge }}\n              onInit={(inst) => (reactFlowInstanceRef.current = inst)}\n              onNodeClick={onNodeClick}\n              onNodesChange={onNodesChange}\n              onNodeDragStart={onNodeDragStart}\n              onNodeDragStop={onNodeDragStop}\n              nodesDraggable={dragEnabled}\n              nodesConnectable={false}\n              fitView\n              fitViewOptions={{ padding: 0.2 }}\n              style={{ width: \"100%\", height: \"100%\" }}\n            >\n              <Controls />\n              <MiniMap nodeColor={(n) => n.style?.background || \"#888\"} />\n              <Background variant={BackgroundVariant.Dots} gap={16} />\n            </ReactFlow>\n          )}\n        </section>\n      </div>\n\n      {/* New: Measurement Framework Prompt panel (bottom-left) */}\n      <div className={`prompt-panel ${promptVisible ? \"open\" : \"closed\"}`} aria-hidden={!promptVisible}>\n        {!promptVisible ? (\n          <button\n            className=\"prompt-toggle btn small\"\n            onClick={() => setPromptVisible(true)}\n            title=\"Show Measurement Framework Prompt\"\n          >\n            Show Measurement Framework Prompt\n          </button>\n        ) : (\n          <div className=\"prompt-content\">\n            <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", gap: 8 }}>\n              <strong>Measurement Framework Prompt</strong>\n              <div style={{ display: \"flex\", gap: 6 }}>\n                <button className=\"btn small\" onClick={copyPromptToClipboard}>Copy</button>\n                <button className=\"btn small\" onClick={() => setPromptVisible(false)}>Hide</button>\n              </div>\n            </div>\n            <textarea\n              readOnly\n              value={measurementPrompt}\n              rows={8}\n              style={{ width: \"100%\", marginTop: 8, resize: \"vertical\", padding: 8, background: \"#061322\", color: \"#e6eef6\", border: \"1px solid #15202b\", borderRadius: 6 }}\n            />\n          </div>\n        )}\n      </div>\n\n      <style>{`\n        body,html,#root{height:100%;margin:0}\n        .app-root{font-family:Inter,Arial,sans-serif;color:#e6eef6;background:#071022;min-height:100vh}\n        .topbar{height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid #0b1220}\n        .controls{display:flex;gap:8px;flex-wrap:wrap}\n        .brand{font-weight:600}\n        .btn{background:#0b1220;border:1px solid #15202b;padding:6px 10px;border-radius:6px;color:#e6eef6;cursor:pointer}\n        .btn.small{font-size:13px;padding:4px 8px}\n        .link{background:none;border:none;color:#7dd3fc;cursor:pointer;font-size:13px}\n        .link.danger{color:#fb7185}\n        .main{display:flex;height:calc(100vh - 60px);position:relative}\n        .sidebar{width:360px;background:#071827;border-right:1px solid #0b1220;padding:14px;overflow:auto}\n        .sidebar-toggle{position:absolute;top:50%;transform:translateY(-50%);z-index:10;background:#0b1220;border:1px solid #15202b;color:#e6eef6;padding:8px 6px;cursor:pointer;border-radius:0 6px 6px 0;transition:left 0.3s}\n        .canvas{flex:1;padding:12px;position:relative}\n        .muted{color:#94a3b8;font-size:13px}\n        .empty-state{color:#9aa4b2;text-align:center;padding-top:80px}\n        .react-flow__node{cursor:${dragEnabled ? \"grab\" : \"default\"}}\n        .export-clean .react-flow__controls,\n        .export-clean .react-flow__minimap,\n        .export-clean .react-flow__attribution,\n        .export-clean .react-flow__background {\n          display: none !important;\n        }\n        .export-clean .react-flow {\n          background: #fff !important;\n        }\n\n        /* Prompt panel (bottom-left) */\n        .prompt-panel { position: fixed; left: 12px; bottom: 12px; z-index: 60; max-width: 420px; width: calc(35vw + 120px); }\n        .prompt-panel.closed .prompt-toggle { display: inline-block; }\n        .prompt-panel.open .prompt-toggle { display: none; }\n        .prompt-content { background:#071827;border:1px solid #0b1220;padding:10px;border-radius:8px;box-shadow:0 6px 18px rgba(2,6,23,0.6) }\n        .prompt-toggle{ white-space:nowrap; }\n        @media (max-width: 900px) {\n          .prompt-panel { width: 320px; left: 8px; bottom: 8px; }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}